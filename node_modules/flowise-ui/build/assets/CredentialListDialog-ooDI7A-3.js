import{af as ie,b4 as A,P as h,r as p,bJ as re,j as e,a9 as le,aq as ce,R as de,B as z,l as B,a8 as pe,o as Q,p as he,c as W,bR as fe,q as Y,H as $,D as Z,h as P,d as H,k as ee,S as q,a1 as J,n as R,m as ge,aa as ue,s as te,E as T,bS as K,J as me,K as xe,a as ye,aA as be,aB as je}from"./index-B1XR3Coy.js";import{T as Ce,H as ve}from"./TooltipWithParser-C72LCUcD.js";import{C as we}from"./ConfirmDialog-Bksga_et.js";import{D as De}from"./Dropdown-BH_BuIwh.js";import{S as Se,I as ke}from"./Input-C2v4FwXn.js";import{S as Ae}from"./Switch-BtbcRzr_.js";import{R as G}from"./main-BBsr8sqY.js";import{F as Ee}from"./FormControl-Cb0ROeST.js";import{I as Oe}from"./IconArrowsMaximize-BrsSDZNx.js";import{I as Ie}from"./IconAlertTriangle-Bdlxpe5D.js";import{I as X}from"./InputAdornment-D6_duzKN.js";import{b as Re}from"./IconSearch-BzBgax5m.js";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Te=ie("outline","hand-stop","IconHandStop",[["path",{d:"M8 13v-7.5a1.5 1.5 0 0 1 3 0v6.5",key:"svg-0"}],["path",{d:"M11 5.5v-2a1.5 1.5 0 1 1 3 0v8.5",key:"svg-1"}],["path",{d:"M14 5.5a1.5 1.5 0 0 1 3 0v6.5",key:"svg-2"}],["path",{d:"M17 7.5a1.5 1.5 0 0 1 3 0v8.5a6 6 0 0 1 -6 6h-2h.208a6 6 0 0 1 -5.012 -2.7a69.74 69.74 0 0 1 -.196 -.3c-.312 -.479 -1.407 -2.388 -3.286 -5.728a1.5 1.5 0 0 1 .536 -2.022a1.867 1.867 0 0 1 2.28 .28l1.47 1.47",key:"svg-3"}]]);const Ne=()=>A.get("/credentials"),ze=t=>A.get(`/credentials?credentialName=${t}`),Me=()=>A.get("/components-credentials"),Le=t=>A.get(`/credentials/${t}`),Ve=t=>A.get(`/components-credentials/${t}`),Be=t=>A.post("/credentials",t),$e=(t,a)=>A.put(`/credentials/${t}`,a),Ue=t=>A.delete(`/credentials/${t}`),N={getAllCredentials:Ne,getCredentialsByName:ze,getAllComponentsCredentials:Me,getSpecificCredential:Le,getSpecificComponentCredential:Ve,createCredential:Be,updateCredential:$e,deleteCredential:Ue},ae=({value:t,onChange:a,inputParam:i,nodes:C,edges:f,nodeId:v,disabled:l=!1,isDarkMode:x=!1,isSequentialAgent:b=!1})=>{const[c,g]=p.useState(t?JSON.parse(t):{}),[r,w]=p.useState([]),[d,S]=p.useState(""),[y,M]=p.useState(null),o=!!y,L=()=>{M(null)},E=n=>{const I=ce.cloneDeep(c);I[d]=n,a(JSON.stringify(I)),g(U=>({...U,[d]:n}))},V=n=>{const I=n.src;Array.isArray(I)||typeof I=="object"?navigator.clipboard.writeText(JSON.stringify(I,null,"  ")):navigator.clipboard.writeText(I)};return p.useEffect(()=>{if(!l&&C&&f&&v&&i){const n=i!=null&&i.acceptVariable?re(C,f,v,i.id):[];w(n)}},[l,i,C,f,v]),e.jsxs(e.Fragment,{children:[e.jsxs(Ee,{sx:{mt:1,width:"100%"},size:"small",children:[l&&e.jsx(G,{theme:x?"ocean":"rjv-default",style:{padding:10,borderRadius:10},src:c,name:null,enableClipboard:n=>V(n),quotesOnKeys:!1,displayDataTypes:!1}),!l&&e.jsx("div",{onClick:n=>n.stopPropagation(),onKeyDown:n=>{(n.key==="Enter"||n.key===" ")&&n.stopPropagation()},role:"button","aria-label":"JSON Editor",tabIndex:0,children:e.jsx(G,{theme:x?"ocean":"rjv-default",style:{padding:10,borderRadius:10},src:c,name:null,quotesOnKeys:!1,displayDataTypes:!1,enableClipboard:n=>V(n),onMouseUp:n=>{i!=null&&i.acceptVariable&&(S(n.name),M(n.currentTarget))},onEdit:n=>{g(n.updated_src),a(JSON.stringify(n.updated_src))},onAdd:()=>{},onDelete:n=>{g(n.updated_src),a(JSON.stringify(n.updated_src))}})},JSON.stringify(c))]}),(i==null?void 0:i.acceptVariable)&&e.jsx(le,{open:o,anchorEl:y,onClose:L,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:e.jsx(Se,{disabled:l,availableNodesForVariable:r,onSelectAndReturnVal:n=>{E(n),L()},isSequentialAgent:b})})]})};ae.propTypes={value:h.string,onChange:h.func,disabled:h.bool,isDarkMode:h.bool,inputParam:h.object,nodes:h.array,edges:h.array,nodeId:h.string,isSequentialAgent:h.bool};const se=({inputParam:t,data:a,disabled:i=!1})=>{const C=de(r=>r.customization),f=p.useRef(null),[v,l]=p.useState(!1),[x,b]=p.useState({}),c=(r,w)=>{b({value:r,inputParam:w,disabled:i,confirmButtonName:"Save",cancelButtonName:"Cancel"}),l(!0)},g=(r,w)=>{l(!1),a[w]=r};return e.jsx("div",{ref:f,children:t&&e.jsx(e.Fragment,{children:e.jsxs(z,{sx:{p:2},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(B,{children:[t.label,!t.optional&&e.jsx("span",{style:{color:"red"},children:" *"}),t.description&&e.jsx(Ce,{style:{marginLeft:10},title:t.description})]}),e.jsx("div",{style:{flexGrow:1}}),t.type==="string"&&t.rows&&e.jsx(pe,{size:"small",sx:{height:25,width:25},title:"Expand",color:"primary",onClick:()=>c(a[t.name]??t.default??"",t),children:e.jsx(Oe,{})})]}),t.warning&&e.jsxs("div",{style:{display:"flex",flexDirection:"row",borderRadius:10,background:"rgb(254,252,191)",padding:10,marginTop:10,marginBottom:10},children:[e.jsx(Ie,{size:36,color:"orange"}),e.jsx("span",{style:{color:"rgb(116,66,16)",marginLeft:10},children:t.warning})]}),t.type==="boolean"&&e.jsx(Ae,{disabled:i,onChange:r=>a[t.name]=r,value:a[t.name]??t.default??!1}),(t.type==="string"||t.type==="password"||t.type==="number")&&e.jsx(ke,{disabled:i,inputParam:t,onChange:r=>a[t.name]=r,value:a[t.name]??t.default??"",showDialog:v,dialogProps:x,onDialogCancel:()=>l(!1),onDialogConfirm:(r,w)=>g(r,w)},a[t.name]),t.type==="json"&&e.jsx(ae,{disabled:i,onChange:r=>a[t.name]=r,value:a[t.name]??t.default??"",isDarkMode:C.isDarkMode}),t.type==="options"&&e.jsx(De,{disabled:i,name:t.name,options:t.options,onSelect:r=>a[t.name]=r,value:a[t.name]??t.default??"choose an option"})]})})})};se.propTypes={inputAnchor:h.object,inputParam:h.object,data:h.object,disabled:h.bool};const _e=t=>A.post(`/oauth2-credential/authorize/${t}`),Fe=t=>A.post(`/oauth2-credential/refresh/${t}`),He=t=>A.get(`/oauth2-credential/callback?${t}`),Je={authorize:_e,refresh:Fe,getCallback:He},ne="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='currentColor'%20class='icon%20icon-tabler%20icons-tabler-filled%20icon-tabler-key'%3e%3cpath%20stroke='none'%20d='M0%200h24v24H0z'%20fill='none'/%3e%3cpath%20d='M14.52%202c1.029%200%202.015%20.409%202.742%201.136l3.602%203.602a3.877%203.877%200%200%201%200%205.483l-2.643%202.643a3.88%203.88%200%200%201%20-4.941%20.452l-.105%20-.078l-5.882%205.883a3%203%200%200%201%20-1.68%20.843l-.22%20.027l-.221%20.009h-1.172c-1.014%200%20-1.867%20-.759%20-1.991%20-1.823l-.009%20-.177v-1.172c0%20-.704%20.248%20-1.386%20.73%20-1.96l.149%20-.161l.414%20-.414a1%201%200%200%201%20.707%20-.293h1v-1a1%201%200%200%201%20.883%20-.993l.117%20-.007h1v-1a1%201%200%200%201%20.206%20-.608l.087%20-.1l1.468%20-1.469l-.076%20-.103a3.9%203.9%200%200%201%20-.678%20-1.963l-.007%20-.236c0%20-1.029%20.409%20-2.015%201.136%20-2.742l2.643%20-2.643a3.88%203.88%200%200%201%202.741%20-1.136m.495%205h-.02a2%202%200%201%200%200%204h.02a2%202%200%201%200%200%20-4'%20/%3e%3c/svg%3e",We=({show:t,dialogProps:a,onCancel:i,onConfirm:C,setError:f})=>{const v=document.getElementById("portal"),l=Q();he();const x=(...s)=>l(me(...s)),b=(...s)=>l(xe(...s)),c=W(N.getSpecificCredential),g=W(N.getSpecificComponentCredential),[r,w]=p.useState({}),[d,S]=p.useState(""),[y,M]=p.useState({}),[o,L]=p.useState({}),[E,V]=p.useState(!1);p.useEffect(()=>{if(c.data){const s=c.data.shared;V(s),s||(w(c.data),c.data.name&&S(c.data.name),c.data.plainDataObj&&M(c.data.plainDataObj),g.request(c.data.credentialName))}},[c.data]),p.useEffect(()=>{g.data&&L(g.data)},[g.data]),p.useEffect(()=>{c.error&&f&&f(c.error)},[c.error]),p.useEffect(()=>{g.error&&f&&f(g.error)},[g.error]),p.useEffect(()=>{if(a.type==="EDIT"&&a.data)c.request(a.data.id);else if(a.type==="EDIT"&&a.credentialId)c.request(a.credentialId);else if(a.type==="ADD"&&a.credentialComponent){S(""),w({});const s=fe(a.credentialComponent.inputs);M(s),L(a.credentialComponent)}},[a]),p.useEffect(()=>(l(t?{type:Y}:{type:$}),()=>l({type:$})),[t,l]);const n=async()=>{try{const s={name:d,credentialName:o.name,plainDataObj:y},m=await N.createCredential(s);m.data&&(x({message:"New Credential added",options:{key:new Date().getTime()+Math.random(),variant:"success",action:u=>e.jsx(R,{style:{color:"white"},onClick:()=>b(u),children:e.jsx(T,{})})}}),C(m.data.id))}catch(s){f&&f(s),x({message:`Failed to add new Credential: ${typeof s.response.data=="object"?s.response.data.message:s.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:m=>e.jsx(R,{style:{color:"white"},onClick:()=>b(m),children:e.jsx(T,{})})}}),i()}},I=async()=>{try{const s={name:d,credentialName:o.name};let m={};for(const D in y)y[D]!==K&&(m[D]=y[D]);Object.keys(m).length&&(s.plainDataObj=m);const u=await N.updateCredential(r.id,s);u.data&&(x({message:"Credential saved",options:{key:new Date().getTime()+Math.random(),variant:"success",action:D=>e.jsx(R,{style:{color:"white"},onClick:()=>b(D),children:e.jsx(T,{})})}}),C(u.data.id))}catch(s){f&&f(s),x({message:`Failed to save Credential: ${typeof s.response.data=="object"?s.response.data.message:s.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:m=>e.jsx(R,{style:{color:"white"},onClick:()=>b(m),children:e.jsx(T,{})})}}),i()}},U=async()=>{var s,m;try{let u=null;if(a.type==="ADD"){const j={name:d,credentialName:o.name,plainDataObj:y},k=await N.createCredential(j);k.data&&(u=k.data.id)}else{const j={name:d,credentialName:o.name};let k={};for(const O in y)y[O]!==K&&(k[O]=y[O]);Object.keys(k).length&&(j.plainDataObj=k),(await N.updateCredential(r.id,j)).data&&(u=r.id)}if(!u)throw new Error("Failed to save credential");const D=await Je.authorize(u);if(D.data&&D.data.success&&D.data.authorizationUrl){const j=window.open(D.data.authorizationUrl,"_blank","width=600,height=700,scrollbars=yes,resizable=yes");if(!j)throw new Error("Failed to open authorization window. Please check if popups are blocked.");const k=O=>{O.data&&(O.data.type==="OAUTH2_SUCCESS"||O.data.type==="OAUTH2_ERROR")&&(window.removeEventListener("message",k),O.data.type==="OAUTH2_SUCCESS"?(x({message:"OAuth2 authorization completed successfully",options:{key:new Date().getTime()+Math.random(),variant:"success",action:F=>e.jsx(R,{style:{color:"white"},onClick:()=>b(F),children:e.jsx(T,{})})}}),C(u)):O.data.type==="OAUTH2_ERROR"&&x({message:O.data.message||"OAuth2 authorization failed",options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:F=>e.jsx(R,{style:{color:"white"},onClick:()=>b(F),children:e.jsx(T,{})})}}),j&&!j.closed&&j.close())};window.addEventListener("message",k);const _=setInterval(()=>{j.closed&&(clearInterval(_),window.removeEventListener("message",k),C(u))},1e3);setTimeout(()=>{clearInterval(_),window.removeEventListener("message",k),j&&!j.closed&&j.close()},3e5)}else throw new Error("Invalid response from authorization endpoint")}catch(u){console.error("OAuth2 authorization error:",u),f&&f(u),x({message:`OAuth2 authorization failed: ${((m=(s=u.response)==null?void 0:s.data)==null?void 0:m.message)||u.message||"Unknown error"}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:D=>e.jsx(R,{style:{color:"white"},onClick:()=>b(D),children:e.jsx(T,{})})}})}},oe=t?e.jsxs(Z,{fullWidth:!0,maxWidth:"sm",open:t,onClose:i,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(P,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:!E&&o&&o.label&&e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx("div",{style:{width:50,height:50,marginRight:10,borderRadius:"50%",backgroundColor:"white"},children:e.jsx("img",{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"},alt:o.name,src:`${H}/api/v1/components-credentials-icon/${o.name}`,onError:s=>{s.target.onerror=null,s.target.style.padding="5px",s.target.src=ne}})}),o.label]})}),e.jsxs(ee,{children:[E&&e.jsx("div",{style:{display:"flex",flexDirection:"column",borderRadius:10,background:"#f37a97",padding:10,marginTop:10,marginBottom:10},children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(Te,{size:25,color:"white"}),e.jsx("span",{style:{color:"white",marginLeft:10,fontWeight:400},children:"Cannot edit shared credential."})]})}),!E&&o&&o.description&&e.jsx(z,{sx:{pl:2,pr:2},children:e.jsx("div",{style:{display:"flex",flexDirection:"row",borderRadius:10,background:"rgb(254,252,191)",padding:10,marginTop:10,marginBottom:10},children:e.jsx("span",{style:{color:"rgb(116,66,16)"},children:ve(o.description)})})}),!E&&o&&o.label&&e.jsxs(z,{sx:{p:2},children:[e.jsx(q,{sx:{position:"relative"},direction:"row",children:e.jsxs(B,{variant:"overline",children:["Credential Name",e.jsx("span",{style:{color:"red"},children:" *"})]})}),e.jsx(J,{id:"credName",type:"string",fullWidth:!0,placeholder:o.label,value:d,name:"name",onChange:s=>S(s.target.value)})]}),!E&&o&&o.name&&o.name.includes("OAuth2")&&e.jsxs(z,{sx:{p:2},children:[e.jsx(q,{sx:{position:"relative"},direction:"row",children:e.jsx(B,{variant:"overline",children:"OAuth Redirect URL"})}),e.jsx(J,{id:"oauthRedirectUrl",type:"string",disabled:!0,fullWidth:!0,value:`${H}/api/v1/oauth2-credential/callback`})]}),!E&&o&&o.inputs&&o.inputs.filter(s=>s.hidden!==!0).map((s,m)=>e.jsx(se,{inputParam:s,data:y},m)),!E&&o&&o.name&&o.name.includes("OAuth2")&&e.jsx(z,{sx:{p:2},children:e.jsx(R,{variant:"contained",color:"secondary",onClick:()=>U(),children:"Authenticate"})})]}),e.jsx(ge,{children:!E&&e.jsx(ue,{disabled:!d,variant:"contained",onClick:()=>a.type==="ADD"?n():I(),children:a.confirmButtonName})}),e.jsx(we,{})]}):null;return te.createPortal(oe,v)};We.propTypes={show:h.bool,dialogProps:h.object,onCancel:h.func,onConfirm:h.func,setError:h.func};const qe=({show:t,dialogProps:a,onCancel:i,onCredentialSelected:C})=>{const f=document.getElementById("portal"),v=Q(),l=ye(),[x,b]=p.useState(""),[c,g]=p.useState([]),r=d=>{b(d),setTimeout(()=>{if(d){const S=a.componentsCredentials.filter(y=>y.name.toLowerCase().includes(d.toLowerCase()));g(S)}else d===""&&g(a.componentsCredentials)},500)};p.useEffect(()=>{a.componentsCredentials&&g(a.componentsCredentials)},[a]),p.useEffect(()=>(v(t?{type:Y}:{type:$}),()=>v({type:$})),[t,v]);const w=t?e.jsxs(Z,{fullWidth:!0,maxWidth:"md",open:t,onClose:i,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(P,{sx:{fontSize:"1rem",p:3,pb:0},id:"alert-dialog-title",children:a.title}),e.jsxs(ee,{sx:{display:"flex",flexDirection:"column",gap:2,maxHeight:"75vh",position:"relative",px:3,pb:3},children:[e.jsx(z,{sx:{backgroundColor:l.palette.background.paper,pt:2,position:"sticky",top:0,zIndex:10},children:e.jsx(J,{sx:{width:"100%",pr:2,pl:2,position:"sticky"},id:"input-search-credential",value:x,onChange:d=>r(d.target.value),placeholder:"Search credential",startAdornment:e.jsx(X,{position:"start",children:e.jsx(Re,{stroke:1.5,size:"1rem",color:l.palette.grey[500]})}),endAdornment:e.jsx(X,{position:"end",sx:{cursor:"pointer",color:l.palette.grey[500],"&:hover":{color:l.palette.grey[900]}},title:"Clear Search",children:e.jsx(T,{stroke:1.5,size:"1rem",onClick:()=>r(""),style:{cursor:"pointer"}})}),"aria-describedby":"search-helper-text",inputProps:{"aria-label":"weight"}})}),e.jsx(be,{sx:{width:"100%",display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:2,py:0,zIndex:9,borderRadius:"10px",[l.breakpoints.down("md")]:{maxWidth:370}},children:[...c].map(d=>e.jsxs(je,{alignItems:"center",onClick:()=>C(d),sx:{border:1,borderColor:l.palette.grey[900]+25,borderRadius:2,display:"flex",alignItems:"center",justifyContent:"start",textAlign:"left",gap:1,p:2},children:[e.jsx("div",{style:{width:50,height:50,borderRadius:"50%",backgroundColor:"white",flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("img",{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"},alt:d.name,src:`${H}/api/v1/components-credentials-icon/${d.name}`,onError:S=>{S.target.onerror=null,S.target.style.padding="5px",S.target.src=ne}})}),e.jsx(B,{children:d.label})]},d.name))})]})]}):null;return te.createPortal(w,f)};qe.propTypes={show:h.bool,dialogProps:h.object,onCancel:h.func,onCredentialSelected:h.func};export{We as A,qe as C,ae as J,N as c,ne as k};
