import{P as x,r as o,a as Oe,R as Ce,bI as we,j as e,a8 as me,cU as at,B as V,d as J,l as ye,z as he,n as Z,o as De,E as Q,cV as _e,p as Be,c as oe,cW as Ue,q as ot,H as Ie,D as st,h as nt,k as rt,bN as it,cv as lt,s as ct,cx as Ae,cy as Ee,cz as je,cw as dt,aC as pt,J as qe,K as Le,u as ut,Q as ft,cS as mt,cX as ht,ar as gt,al as ge,cY as $e,cZ as xt,am as yt,c_ as wt,aq as le,bL as ve,c$ as bt,d0 as jt}from"./index-B1XR3Coy.js";import{C as vt,I as Ct,a as Dt,B as St}from"./style-BgWmVXbp.js";import{N as Nt,a as kt,b as It,A as At,S as Et}from"./StickyNote-D1Y7PjYe.js";import{N as Te,g as $t,E as Tt,u as Pt,b as Rt,R as Ft,c as Ot}from"./DocStoreInputHandler-9-EYgHTZ.js";import{N as _t}from"./NodeInfoDialog-BBny0-Sx.js";import{L as Bt}from"./llamaindex-B_JSDULd.js";import{I as Ut}from"./IconCopy-BBl1XuSo.js";import{I as qt}from"./IconTrash-BvhWIQ6v.js";import{T as Lt}from"./Tooltip-9ICsuaYn.js";import{I as Vt}from"./IconAlertTriangle-Bdlxpe5D.js";/* empty css              */import{u as Wt,C as zt,A as Ht,I as Jt,a as Gt}from"./usePrompt-DI6ewMaj.js";import{u as Mt,C as Yt}from"./ConfirmDialog-Bksga_et.js";import{S as Kt,F as Xt}from"./StyledFab-BqTal21_.js";import{b as Zt,T as Pe,c as Re,p as Fe,j as Qt,d as ea}from"./index-BmqHKIDU.js";import{B as ta}from"./BackdropLoader-C982mQas.js";import{T as aa}from"./Table-CcAGPqUI.js";import{d as oa}from"./ExpandMore-BP5oMSwT.js";import{c as sa}from"./config-CuKonRqx.js";import{v as na}from"./vectorstore-BUOpP3fi.js";import{A as ra,d as ia,e as la}from"./MemoizedReactMarkdown-CNH2mkE4.js";import{T as ca}from"./Tabs-DwCJa_eq.js";import{I as da}from"./IconExclamationCircle-BsAK4qbB.js";import{I as pa}from"./IconBulb-CwCq2_I0.js";import{U as ua}from"./UpsertResultDialog-B7g2uZ1e.js";import{I as fa}from"./IconDatabaseImport-DtH2cDVP.js";import{n as ma}from"./nodes-D-x6LTqi.js";import{c as ce}from"./chatflows-ITLPd47E.js";import"./Dropdown-BH_BuIwh.js";import"./Autocomplete-2B99MXTa.js";import"./Close-CA_iFeNy.js";import"./FormControl-Cb0ROeST.js";import"./TextField-BEeUeVUl.js";import"./InputLabel-HPVYUEFn.js";import"./Input-C2v4FwXn.js";import"./ListItem-C9nlU6HX.js";import"./MultiDropdown-OnTaU3K-.js";import"./CredentialInputHandler-NSWgGX5U.js";import"./CredentialListDialog-ooDI7A-3.js";import"./TooltipWithParser-C72LCUcD.js";import"./index-D--Rb2MU.js";import"./Switch-BtbcRzr_.js";import"./main-BBsr8sqY.js";import"./IconArrowsMaximize-BrsSDZNx.js";import"./InputAdornment-D6_duzKN.js";import"./IconSearch-BzBgax5m.js";import"./Delete-CvnCkEIf.js";import"./IconPlus-DpyX5kZB.js";import"./Grid-DtMOPoeK.js";import"./toPropertyKey-hKuLU48H.js";import"./createStyled-BzRwilhm.js";import"./Skeleton-BQAmmov-.js";import"./KeyboardArrowRight-KQTKBFVE.js";import"./LastPage-CMvObEkB.js";import"./GridActionsCellItem-C4fgcfe6.js";import"./File-B2PWlg1I.js";import"./CodeEditor-BjDzi2Vy.js";import"./index-DhL3T6x0.js";import"./suggestionOption-CTRD7oqB.js";import"./TabPanel-C2EL9Kp7.js";import"./ExpandTextDialog-Sszv9N4G.js";import"./LoadingButton-BHZSG_sF.js";import"./IconRefresh-B2aTlEaU.js";import"./ToolDialog-hiXiaWJY.js";import"./ExportAsTemplateDialog-CN3tapJC.js";import"./AssistantDialog-BG0DIOgO.js";import"./assistants-C-o7l-z6.js";import"./v4-D8aEg3BZ.js";import"./Stepper-CvQjJ8b9.js";import"./IconLanguage-Dreb5nKM.js";import"./documentstore-GQ_lrBF1.js";import"./string-3NetaFjT.js";import"./SaveChatflowDialog-C2LCggZV.js";import"./react-datepicker-CbT3l_H_.js";import"./moment-9Y6NtRWJ.js";import"./IconChevronsUp-iPfKij1q.js";import"./IconChevronLeft-Dkfa8829.js";import"./IconDeviceFloppy-CcMo-Sl3.js";import"./NodeExecutionDetails-DAbNicF8.js";import"./IconClock-eC9b3RM9.js";import"./ToggleButtonGroup-D1WH89Fe.js";import"./CardMedia-DxratGiC.js";import"./StopCircle-i-Eq3mUR.js";import"./IconCircleXFilled-eMwzVwFM.js";import"./_baseAssignValue-D7-4vid5.js";import"./apikey-DdsPjp8B.js";import"./StatsCard-Dg5IN5gY.js";import"./Pagination-DyTukyc1.js";import"./SpeechToText-BX3-pddK.js";const Ve=({data:n})=>{var ee,te,M,ae,H,Y;const s=Oe(),C=Ce(l=>l.canvas),{deleteNode:k,duplicateNode:D}=o.useContext(we),[y,w]=o.useState(!1),[I,g]=o.useState({}),[$,m]=o.useState(!1),[R,S]=o.useState({}),[b,j]=o.useState(""),[v,F]=o.useState(!1),[T,B]=o.useState(null),W=()=>{F(!1)},z=()=>{F(!0)},G=()=>T?!1:!C.canvasDialogShow&&v,P=(l,N)=>`Node version ${l} outdated
Update to latest version ${N}`,se=l=>`Node outdated
Update to latest version ${l}`,U=()=>{const l={data:n,inputParams:n.inputParams.filter(N=>!N.hidden).filter(N=>N.additionalParams),confirmButtonName:"Save",cancelButtonName:"Cancel"};g(l),w(!0)},q=()=>{var l;return n.selected?s.palette.primary.main:(l=s==null?void 0:s.customization)!=null&&l.isDarkMode?s.palette.grey[900]+25:s.palette.grey[900]+50};return o.useEffect(()=>{const l=C.componentNodes.find(N=>N.name===n.name);l&&(n.version?n.version&&l.version>n.version?j(P(n.version,l.version)):l.badge==="DEPRECATING"?j((l==null?void 0:l.deprecateMessage)??"This node will be deprecated in the next release. Change to a new node tagged with NEW"):j(""):j(se(l.version)))},[C.componentNodes,n.name,n.version]),e.jsxs(e.Fragment,{children:[e.jsx(Nt,{content:!1,sx:{padding:0,borderColor:q()},border:!1,children:e.jsx(kt,{open:G(),onClose:W,onOpen:z,disableFocusListener:!0,title:e.jsxs("div",{style:{background:"transparent",display:"flex",flexDirection:"column"},children:[e.jsx(me,{title:"Duplicate",onClick:()=>{D(n.id)},sx:{height:"35px",width:"35px","&:hover":{color:s==null?void 0:s.palette.primary.main}},color:(ee=s==null?void 0:s.customization)!=null&&ee.isDarkMode?(te=s.colors)==null?void 0:te.paper:"inherit",children:e.jsx(Ut,{})}),e.jsx(me,{title:"Delete",onClick:()=>{k(n.id)},sx:{height:"35px",width:"35px","&:hover":{color:"red"}},color:(M=s==null?void 0:s.customization)!=null&&M.isDarkMode?(ae=s.colors)==null?void 0:ae.paper:"inherit",children:e.jsx(qt,{})}),e.jsx(me,{title:"Info",onClick:()=>{S({data:n}),m(!0)},sx:{height:"35px",width:"35px","&:hover":{color:s==null?void 0:s.palette.secondary.main}},color:(H=s==null?void 0:s.customization)!=null&&H.isDarkMode?(Y=s.colors)==null?void 0:Y.paper:"inherit",children:e.jsx(at,{})})]}),placement:"right-start",children:e.jsxs(V,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(V,{style:{width:50,marginRight:10,padding:10},children:e.jsx("div",{style:{...s.typography.commonAvatar,...s.typography.largeAvatar,borderRadius:"50%",backgroundColor:"white",cursor:"grab",width:"40px",height:"40px"},children:e.jsx("img",{style:{width:"100%",height:"100%",padding:5,objectFit:"contain"},src:`${J}/api/v1/node-icon/${n.name}`,alt:"Notification"})})}),e.jsx(V,{children:e.jsx(ye,{sx:{fontSize:"1rem",fontWeight:500,mr:2},children:n.label})}),e.jsx("div",{style:{flexGrow:1}}),n.tags&&n.tags.includes("LlamaIndex")&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{borderRadius:"50%",padding:15},children:e.jsx("img",{style:{width:"25px",height:"25px",borderRadius:"50%",objectFit:"contain"},src:Bt,alt:"LlamaIndex"})})}),b&&e.jsx(e.Fragment,{children:e.jsx(Lt,{title:e.jsx("span",{style:{whiteSpace:"pre-line"},children:b}),placement:"top",children:e.jsx(me,{sx:{height:35,width:35},children:e.jsx(Vt,{size:35,color:"orange"})})})})]}),(n.inputAnchors.length>0||n.inputParams.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx(he,{}),e.jsx(V,{sx:{background:s.palette.asyncSelect.main,p:1},children:e.jsx(ye,{sx:{fontWeight:500,textAlign:"center"},children:"Inputs"})}),e.jsx(he,{})]}),n.inputAnchors.map((l,N)=>e.jsx(Te,{inputAnchor:l,data:n},N)),n.inputParams.filter(l=>!l.hidden).filter(l=>l.display!==!1).map((l,N)=>e.jsx(Te,{inputParam:l,data:n,onHideNodeInfoDialog:ne=>{B(ne?!0:null)}},N)),n.inputParams.find(l=>l.additionalParams)&&e.jsx("div",{style:{textAlign:"center",marginTop:n.inputParams.filter(l=>l.additionalParams).length===n.inputParams.length+n.inputAnchors.length?20:0},children:e.jsx(Z,{sx:{borderRadius:25,width:"90%",mb:2},variant:"outlined",onClick:U,children:"Additional Parameters"})}),n.outputAnchors.length>0&&e.jsx(he,{}),n.outputAnchors.length>0&&e.jsx(V,{sx:{background:s.palette.asyncSelect.main,p:1},children:e.jsx(ye,{sx:{fontWeight:500,textAlign:"center"},children:"Output"})}),n.outputAnchors.length>0&&e.jsx(he,{}),n.outputAnchors.length>0&&n.outputAnchors.map(l=>e.jsx(It,{outputAnchor:l,data:n},JSON.stringify(n)))]})})}),e.jsx(At,{show:y,dialogProps:I,onCancel:()=>w(!1)}),e.jsx(_t,{show:$,dialogProps:R,onCancel:()=>m(!1)})]})};Ve.propTypes={data:x.object};const ha=o.memo(Ve),xe=40,We=({id:n,sourceX:s,sourceY:C,targetX:k,targetY:D,sourcePosition:y,targetPosition:w,style:I={},data:g,markerEnd:$})=>{const[m,R,S]=$t({sourceX:s,sourceY:C,sourcePosition:y,targetX:k,targetY:D,targetPosition:w}),{deleteEdge:b}=o.useContext(we),j=De(),v=(F,T)=>{F.stopPropagation(),b(T),j({type:_e})};return e.jsxs(e.Fragment,{children:[e.jsx("path",{id:n,style:I,className:"react-flow__edge-path",d:m,markerEnd:$}),g&&g.label&&e.jsx(Tt,{x:s+10,y:C+10,label:g.label,labelStyle:{fill:"black"},labelBgStyle:{fill:"transparent"},labelBgPadding:[2,4],labelBgBorderRadius:2}),e.jsx("foreignObject",{width:xe,height:xe,x:R-xe/2,y:S-xe/2,className:"edgebutton-foreignobject",requiredExtensions:"http://www.w3.org/1999/xhtml",children:e.jsx("div",{children:e.jsx("button",{className:"edgebutton",onClick:F=>v(F,n),children:e.jsx(Q,{stroke:2,size:"12"})})})})]})};We.propTypes={id:x.string,sourceX:x.number,sourceY:x.number,targetX:x.number,targetY:x.number,sourcePosition:x.any,targetPosition:x.any,style:x.object,data:x.object,markerEnd:x.any};const ga=o.memo(We);function ze(n){const{children:s,value:C,index:k,...D}=n;return e.jsx("div",{role:"tabpanel",hidden:C!==k,id:`attachment-tabpanel-${k}`,"aria-labelledby":`attachment-tab-${k}`,...D,children:C===k&&e.jsx(V,{sx:{p:1},children:s})})}ze.propTypes={children:x.node,index:x.number.isRequired,value:x.number.isRequired};function xa(n){return{id:`attachment-tab-${n}`,"aria-controls":`attachment-tabpanel-${n}`}}const He=({show:n,dialogProps:s,onCancel:C,onIndexResult:k})=>{const D=document.getElementById("portal"),{reactFlowInstance:y}=o.useContext(we),w=De();Be();const I=(...t)=>w(qe(...t)),g=(...t)=>w(Le(...t)),$=oe(sa.getConfig),[m,R]=o.useState([]),[S,b]=o.useState(!1),[j,v]=o.useState({}),[F,T]=o.useState({}),[B,W]=o.useState({}),[z,G]=o.useState(0),[P,se]=o.useState(""),[U,q]=o.useState({}),ee=(t,i)=>t.filter(r=>i.some(c=>r.nodeId===c.id)),te=(t,i,r,c)=>t==="Python"?`import requests

API_URL = "${J}/api/v1/vector/upsert/${s.chatflowid}"

def query(payload):
    response = requests.post(API_URL, json=payload)
    return response.json()

output = query({
    ${r?`"stopNodeId": "${i}",
    `:""}"overrideConfig": {${Ae(c,"json",r,i)}
    }
})
`:t==="JavaScript"?`async function query(data) {
    const response = await fetch(
        "${J}/api/v1/vector/upsert/${s.chatflowid}",
        {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(data)
        }
    );
    const result = await response.json();
    return result;
}

query({
  ${r?`"stopNodeId": "${i}",
  `:""}"overrideConfig": {${Ee(c,"json",r,i)}
  }
}).then((response) => {
    console.log(response);
});
`:t==="cURL"?`curl ${J}/api/v1/vector/upsert/${s.chatflowid} \\
      -X POST \\
      ${r?`-d '{"stopNodeId": "${i}", "overrideConfig": {${je(c,"json",r,i)}}' \\`:`-d '{"overrideConfig": {${je(c,"json",r,i)}}' \\`}
      -H "Content-Type: application/json"`:"",M=(t,i,r,c)=>{if(t==="Python"){c=dt(c);let O=c[0].type;return O.includes(",")&&(O=O.split(",")[0]),`import requests

API_URL = "${J}/api/v1/vector/upsert/${s.chatflowid}"

# use form data to upload files
form_data = {
    "files": ${`('example${O}', open('example${O}', 'rb'))`}
}
body_data = {${Ae(c,"formData",r,i)}}

def query(form_data, body_data):
    response = requests.post(API_URL, files=form_data, data=body_data)
    return response.json()

output = query(form_data, body_data)
`}else{if(t==="JavaScript")return`// use FormData to upload files
let formData = new FormData();
${Ee(c,"formData",r,i)}
async function query(formData) {
    const response = await fetch(
        "${J}/api/v1/vector/upsert/${s.chatflowid}",
        {
            method: "POST",
            body: formData
        }
    );
    const result = await response.json();
    return result;
}

query(formData).then((response) => {
    console.log(response);
});
`;if(t==="cURL")return`curl ${J}/api/v1/vector/upsert/${s.chatflowid} \\
     -X POST \\${je(c,"formData",r,i)} \\
     -H "Content-Type: multipart/form-data"`}return""},ae=t=>{if(t==="Python")return`# Specify multiple values for a config parameter by specifying the node id
body_data = {
    "openAIApiKey": {
        "chatOpenAI_0": "sk-my-openai-1st-key",
        "openAIEmbeddings_0": "sk-my-openai-2nd-key"
    }
}`;if(t==="JavaScript")return`// Specify multiple values for a config parameter by specifying the node id
formData.append("openAIApiKey[chatOpenAI_0]", "sk-my-openai-1st-key")
formData.append("openAIApiKey[openAIEmbeddings_0]", "sk-my-openai-2nd-key")`;if(t==="cURL")return`-F "openAIApiKey[chatOpenAI_0]=sk-my-openai-1st-key" \\
-F "openAIApiKey[openAIEmbeddings_0]=sk-my-openai-2nd-key" \\`},H=()=>`{
    "overrideConfig": {
        "openAIApiKey": {
            "chatOpenAI_0": "sk-my-openai-1st-key",
            "openAIEmbeddings_0": "sk-my-openai-2nd-key"
        }
    }
}`,Y=t=>t==="Python"?"python":t==="JavaScript"?"javascript":t==="cURL"?"bash":"python",l=t=>t==="Python"?Fe:t==="JavaScript"?Qt:t==="Embed"?EmbedSVG:t==="cURL"?ea:t==="Share Chatbot"?ShareChatbotSVG:t==="Configuration"?settingsSVG:Fe,N=t=>(i,r)=>{const c={...F};c[t]=r,T(c)},ne=t=>{var O;const i={...B};Object.keys(i).includes(t)?i[t]=!i[t]:i[t]=!0,i[t]===!0&&$.request(s.chatflowid),W(i),se(t);const r={...j};r[t]=!1,v(r);const c=((O=m.find(_=>_.vectorNode.data.id===t))==null?void 0:O.nodes)??[];for(const _ of c)if(_.data.inputParams.find(L=>L.type==="file")){r[t]=!0,v(r);break}},de=async t=>{b(!0);try{const i=await na.upsertVectorStore(s.chatflowid,{stopNodeId:t.data.id});I({message:"Succesfully upserted vector store. You can start chatting now!",options:{key:new Date().getTime()+Math.random(),variant:"success",action:r=>e.jsx(Z,{style:{color:"white"},onClick:()=>g(r),children:e.jsx(Q,{})})}}),b(!1),i&&i.data&&typeof i.data=="object"&&k(i.data)}catch(i){I({message:typeof i.response.data=="object"?i.response.data.message:i.response.data,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:r=>e.jsx(Z,{style:{color:"white"},onClick:()=>g(r),children:e.jsx(Q,{})})}}),b(!1)}},pe=t=>{const i=[],r=Object.keys(t.data.inputs);for(let c=0;c<t.data.inputParams.length;c+=1)r.includes(t.data.inputParams[c].name)&&i.push({label:t.data.inputParams[c].label,name:t.data.inputParams[c].name,type:t.data.inputParams[c].type,value:t.data.inputParams[c].type==="file"?pt(t.data.inputs[t.data.inputParams[c].name]):t.data.inputs[t.data.inputParams[c].name]??""});return i};o.useEffect(()=>{var t;if($.data){const i={...U};i[P]=ee($.data,((t=m.find(r=>r.vectorNode.data.id===P))==null?void 0:t.nodes)??[]),q(i)}},[$.data]),o.useEffect(()=>{if(s&&y){const t=y.getNodes(),i=y.getEdges();R(Ue(t,i))}return()=>{R([]),b(!1),v({}),T({}),W({}),G(0),q({})}},[s]),o.useEffect(()=>(w(n?{type:ot}:{type:Ie}),()=>w({type:Ie})),[n,w]);const ue=n?e.jsxs(st,{open:n,fullWidth:!0,maxWidth:"md",onClose:C,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",sx:{overflow:"visible"},children:[e.jsx(nt,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:s.title}),e.jsx(rt,{sx:{display:"flex",justifyContent:"flex-end",flexDirection:"column"},children:e.jsx(it,{style:{height:"100%",maxHeight:"calc(100vh - 220px)",overflowX:"hidden"},children:m.length>0&&m.map((t,i)=>e.jsxs("div",{children:[t.nodes.length>0&&t.nodes.map((r,c)=>e.jsxs(ra,{expanded:F[r.data.id]||!1,onChange:N(r.data.id),disableGutters:!0,children:[e.jsx(ia,{expandIcon:e.jsx(oa,{}),"aria-controls":`nodes-accordian-${r.data.name}`,id:`nodes-accordian-header-${r.data.name}`,children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx("div",{style:{width:40,height:40,marginRight:10,borderRadius:"50%",backgroundColor:"white"},children:e.jsx("img",{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"},alt:r.data.name,src:`${J}/api/v1/node-icon/${r.data.name}`})}),e.jsx(ye,{variant:"h5",children:r.data.label}),e.jsx("div",{style:{display:"flex",flexDirection:"row",width:"max-content",borderRadius:15,background:"rgb(254,252,191)",padding:5,paddingLeft:10,paddingRight:10,marginLeft:10},children:e.jsx("span",{style:{color:"rgb(116,66,16)",fontSize:"0.825rem"},children:r.data.id})})]})}),e.jsx(la,{children:e.jsx(aa,{sx:{minWidth:"max-content"},rows:pe(r),columns:Object.keys(pe(r)[0])})})]},c)),e.jsxs(V,{sx:{p:2},children:[e.jsx(Zt,{label:"Show API",value:B[t.vectorNode.data.id],onChange:()=>ne(t.vectorNode.data.id)},JSON.stringify(B)),B[t.vectorNode.data.id]&&e.jsx("div",{children:e.jsx(ca,{value:z,onChange:(r,c)=>G(c),"aria-label":"tabs",children:["Python","JavaScript","cURL"].map((r,c)=>e.jsx(lt,{icon:e.jsx("img",{style:{objectFit:"cover",height:15,width:"auto"},src:l(r),alt:"code"}),iconPosition:"start",label:r,...xa(c)},c))})}),B[t.vectorNode.data.id]&&j[t.vectorNode.data.id]!==void 0&&U[t.vectorNode.data.id]&&U[t.vectorNode.data.id].length>0&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{marginTop:10},children:["Python","JavaScript","cURL"].map((r,c)=>e.jsxs(ze,{value:z,index:c,children:[e.jsx(Pe,{theme:Re,text:j[t.vectorNode.data.id]?M(r,t.vectorNode.data.id,m.length>1,U[t.vectorNode.data.id]):te(r,t.vectorNode.data.id,m.length>1,U[t.vectorNode.data.id]),language:Y(r),showLineNumbers:!1,wrapLines:!0}),e.jsx("div",{style:{display:"flex",flexDirection:"column",borderRadius:10,background:"rgb(254,252,191)",padding:10,marginTop:20,marginBottom:20},children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(da,{size:30,color:"rgb(116,66,16)"}),e.jsxs("span",{style:{color:"rgb(116,66,16)",marginLeft:10,fontWeight:500},children:["For security reason, override config is disabled by default. You can change this by going into Chatflow Configuration -> Security tab, and enable the property you want to override.","Â Refer"," ",e.jsx("a",{rel:"noreferrer",target:"_blank",href:"https://docs.flowiseai.com/using-flowise/api#override-config",children:"here"})," ","for more details"]})]})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",borderRadius:10,background:"#d8f3dc",padding:10,marginTop:10,marginBottom:10},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(pa,{size:30,color:"#2d6a4f"}),e.jsx("span",{style:{color:"#2d6a4f",marginLeft:10,fontWeight:500},children:"You can also specify multiple values for a config parameter by specifying the node id"})]}),e.jsx("div",{style:{padding:10},children:e.jsx(Pe,{theme:Re,text:j?ae(r):H(),language:Y(r),showLineNumbers:!1,wrapLines:!0})})]})]},c))})})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[S&&e.jsx(ta,{open:S}),!S&&e.jsx(Z,{sx:{color:"white"},fullWidth:!0,variant:"contained",color:"teal",title:"Upsert",onClick:()=>de(t.vectorNode),children:"Upsert"})]})]},i))})})]}):null;return ct.createPortal(ue,D)};He.propTypes={show:x.bool,dialogProps:x.object,onCancel:x.func,onIndexResult:x.func};const Je=({chatflowid:n})=>{const[s,C]=o.useState(!1),[k,D]=o.useState(!1),[y,w]=o.useState({}),[I,g]=o.useState(!1),[$,m]=o.useState({}),R=o.useRef(null),S=o.useRef(s),b=()=>{C(v=>!v),w({open:!0,title:"Upsert Vector Store",chatflowid:n}),D(!0)};return o.useEffect(()=>{S.current===!0&&s===!1&&R.current.focus(),S.current=s},[s,n]),e.jsxs(e.Fragment,{children:[e.jsx(Kt,{sx:{position:"absolute",right:80,top:20},ref:R,size:"small",color:"teal","aria-label":"upsert",title:"Upsert Vector Database",onClick:b,children:s?e.jsx(Q,{}):e.jsx(fa,{})}),e.jsx(He,{show:k,dialogProps:y,onCancel:()=>{D(!1),C(j=>!j)},onIndexResult:j=>{D(!1),g(!0),m({...j})}}),e.jsx(ua,{show:I,dialogProps:$,onCancel:()=>{g(!1),C(!1)}})]})};Je.propTypes={chatflowid:x.string};const ya=o.memo(Je),wa={customNode:ha,stickyNote:Et},ba={buttonedge:ga},os=()=>{const n=Oe(),s=ut(),{hasAssignedWorkspace:C}=ft(),{state:k}=mt(),D=k?k.templateFlowData:"",y=document.location.pathname.toString().split("/"),w=y[y.length-1]==="canvas"||y[y.length-1]==="agentcanvas"?"":y[y.length-1],I=!!y.includes("agentcanvas"),g=y.includes("agentcanvas")?"Agent":"Chatflow",{confirm:$}=Mt(),m=De(),R=Ce(a=>a.customization),S=Ce(a=>a.canvas),[b,j]=o.useState(S),[v,F]=o.useState(null),{reactFlowInstance:T,setReactFlowInstance:B}=o.useContext(we);Be();const W=(...a)=>m(qe(...a)),z=(...a)=>m(Le(...a)),[G,P,se]=Pt(),[U,q,ee]=Rt(),[te,M]=o.useState(null),[ae,H]=o.useState(!1),[Y,l]=o.useState(!1),[N,ne]=o.useState(!1),de=o.useRef(null),[pe,ue]=o.useState(""),[t,i]=o.useState(""),[r,c]=o.useState(""),O=oe(ma.getAllNodes),_=oe(ce.createNewChatflow),L=oe(ce.updateChatflow),K=oe(ce.getSpecificChatflow),re=oe(ce.getHasChatflowChanged),Ge=a=>{const p={...a,type:"buttonedge",id:`${a.source}-${a.sourceHandle}-${a.target}-${a.targetHandle}`},d=a.targetHandle.split("-")[0],f=a.sourceHandle.split("-")[0],u=a.targetHandle.split("-")[2];P(h=>h.map(A=>{if(A.id===d){setTimeout(()=>ie(),0);let E;const Ne=A.data.inputAnchors.find(X=>X.name===u),ke=A.data.inputParams.find(X=>X.name===u);if(Ne&&Ne.list){const X=A.data.inputs[u]||[];u==="tools"?wt(X,f):X.push(`{{${f}.data.instance}}`),E=X}else ke&&ke.acceptVariable?E=A.data.inputs[u]||"":E=`{{${f}.data.instance}}`;A.data={...A.data,inputs:{...A.data.inputs,[u]:E}}}return A})),q(h=>Ot(p,h))},fe=a=>{try{const p=JSON.parse(a),d=p.nodes||[];P(d),q(p.edges||[]),setTimeout(()=>ie(),0)}catch(p){console.error(p)}},Me=async()=>{const a={title:"Delete",description:`Delete ${g} ${v.name}?`,confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await $(a))try{await ce.deleteChatflow(v.id),localStorage.removeItem(`${v.id}_INTERNAL`),s(I?"/agentflows":"/")}catch(d){W({message:typeof d.response.data=="object"?d.response.data.message:d.response.data,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:f=>e.jsx(Z,{style:{color:"white"},onClick:()=>z(f),children:e.jsx(Q,{})})}})}},Ye=async a=>{if(T){const p=T.getNodes().map(u=>{const h=le.cloneDeep(u.data);return Object.prototype.hasOwnProperty.call(h.inputs,ve)&&(h.credential=h.inputs[ve],h.inputs=le.omit(h.inputs,[ve])),u.data={...h,selected:!1},u}),d=T.toObject();d.nodes=p;const f=JSON.stringify(d);if(v.id)i(a),c(f),re.request(v.id,pe);else{const u={name:a,deployed:!1,isPublic:!1,flowData:f,type:I?"MULTIAGENT":"CHATFLOW"};_.request(u)}}},Ke=o.useCallback((a,p)=>{M(p),P(d=>d.map(f=>(f.id===p.id?f.data={...f.data,selected:!0}:f.data={...f.data,selected:!1},f)))}),Xe=o.useCallback(a=>{a.preventDefault(),a.dataTransfer.dropEffect="move"},[]),Ze=o.useCallback(a=>{a.preventDefault();const p=de.current.getBoundingClientRect();let d=a.dataTransfer.getData("application/reactflow");if(typeof d>"u"||!d)return;d=JSON.parse(d);const f=T.project({x:a.clientX-p.left-100,y:a.clientY-p.top-50}),u=ht(d,T.getNodes()),h={id:u,position:f,type:d.type!=="StickyNote"?"customNode":"stickyNote",data:gt(d,u)};M(h),P(A=>A.concat(h).map(E=>(E.id===h.id?E.data={...E.data,selected:!0}:E.data={...E.data,selected:!1},E))),setTimeout(()=>ie(),0)},[T]),Qe=()=>{const a=S.componentNodes,p=le.cloneDeep(G),d=le.cloneDeep(U);let f=[];for(let u=0;u<p.length;u++){const h=p[u],A=a.find(E=>E.name===h.data.name);if(A&&A.version>h.data.version){const E=le.cloneDeep(A);p[u].data=bt(E,h.data),f.push(...jt(p[u].data,d))}}P(p),q(d.filter(u=>!f.includes(u))),ie(),l(!1)},Se=()=>{m({type:$e}),W({message:`${g} saved`,options:{key:new Date().getTime()+Math.random(),variant:"success",action:a=>e.jsx(Z,{style:{color:"white"},onClick:()=>z(a),children:e.jsx(Q,{})})}})},be=a=>{W({message:a,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:p=>e.jsx(Z,{style:{color:"white"},onClick:()=>z(p),children:e.jsx(Q,{})})}})},ie=()=>{m({type:_e})},et=(a,p)=>{Ue(a,p).length?H(!0):H(!1)},tt=a=>{const p=S.componentNodes;for(let d=0;d<a.length;d++){const f=a[d],u=p.find(h=>h.name===f.data.name);if(u&&u.version>f.data.version){l(!0);return}}l(!1)};return o.useEffect(()=>{if(K.data){const a=K.data,p=a.workspaceId;if(!C(p)){s("/unauthorized");return}const d=a.flowData?JSON.parse(a.flowData):[];ue(a.updatedDate),P(d.nodes||[]),q(d.edges||[]),m({type:ge,chatflow:a})}else K.error&&be(`Failed to retrieve ${g}: ${K.error.response.data.message}`)},[K.data,K.error]),o.useEffect(()=>{if(_.data){const a=_.data;m({type:ge,chatflow:a}),Se(),window.history.replaceState(k,null,`/${I?"agentcanvas":"canvas"}/${a.id}`)}else _.error&&be(`Failed to retrieve ${g}: ${_.error.response.data.message}`)},[_.data,_.error]),o.useEffect(()=>{L.data?(m({type:ge,chatflow:L.data}),ue(L.data.updatedDate),Se()):L.error&&be(`Failed to retrieve ${g}: ${L.error.response.data.message}`)},[L.data,L.error]),o.useEffect(()=>{const a=async()=>{var d;if(((d=re.data)==null?void 0:d.hasChanged)===!0){const f={title:"Confirm Change",description:`${g} ${v.name} has changed since you have opened, overwrite changes?`,confirmButtonName:"Confirm",cancelButtonName:"Cancel"};if(!await $(f))return}const p={name:t,flowData:r};L.request(v.id,p)};re.data&&a()},[re.data,re.error]),o.useEffect(()=>{if(F(b.chatflow),b.chatflow){const a=b.chatflow.flowData?JSON.parse(b.chatflow.flowData):[];et(a.nodes||[],a.edges||[]),tt(a.nodes||[])}},[b.chatflow]),o.useEffect(()=>(l(!1),H(!1),w?K.request(w):(localStorage.getItem("duplicatedFlowData")?(fe(localStorage.getItem("duplicatedFlowData")),setTimeout(()=>localStorage.removeItem("duplicatedFlowData"),0)):(P([]),q([])),m({type:ge,chatflow:{name:`Untitled ${g}`}})),O.request(),()=>{setTimeout(()=>m({type:$e}),0)}),[]),o.useEffect(()=>{j(S)},[S]),o.useEffect(()=>{function a(p){const d=p.clipboardData.getData("text");d.includes('{"nodes":[')&&d.includes('],"edges":[')&&fe(d)}return window.addEventListener("paste",a),()=>{window.removeEventListener("paste",a)}},[]),o.useEffect(()=>{D&&D.includes('"nodes":[')&&D.includes('],"edges":[')&&fe(D)},[D]),Wt("You have unsaved changes! Do you want to navigate away?",b.isDirty),e.jsx(e.Fragment,{children:e.jsxs(V,{children:[e.jsx(xt,{enableColorOnDark:!0,position:"fixed",color:"inherit",elevation:1,sx:{bgcolor:n.palette.background.default},children:e.jsx(yt,{children:e.jsx(zt,{chatflow:v,handleSaveFlow:Ye,handleDeleteFlow:Me,handleLoadFlow:fe,isAgentCanvas:I})})}),e.jsx(V,{sx:{pt:"70px",height:"100vh",width:"100%"},children:e.jsx("div",{className:"reactflow-parent-wrapper",children:e.jsx("div",{className:"reactflow-wrapper",ref:de,children:e.jsxs(Ft,{nodes:G,edges:U,onNodesChange:se,onNodeClick:Ke,onEdgesChange:ee,onDrop:Ze,onDragOver:Xe,onNodeDragStop:ie,nodeTypes:wa,edgeTypes:ba,onConnect:Ge,onInit:B,fitView:!0,deleteKeyCode:S.canvasDialogShow?null:["Delete"],minZoom:.1,snapGrid:[25,25],snapToGrid:N,className:"chatflow-canvas",children:[e.jsx(vt,{className:R.isDarkMode?"dark-mode-controls":"",style:{display:"flex",flexDirection:"row",left:"50%",transform:"translate(-50%, -50%)"},children:e.jsx("button",{className:"react-flow__controls-button react-flow__controls-interactive",onClick:()=>{ne(!N)},title:"toggle snapping","aria-label":"toggle snapping",children:N?e.jsx(Ct,{}):e.jsx(Dt,{})})}),e.jsx(St,{color:"#aaa",gap:16}),e.jsx(Ht,{isAgentCanvas:I,nodesData:O.data,node:te}),Y&&e.jsx(Xt,{sx:{left:40,top:20,color:"white",background:"orange","&:hover":{background:"orange",backgroundImage:"linear-gradient(rgb(0 0 0/10%) 0 0)"}},size:"small","aria-label":"sync",title:"Sync Nodes",onClick:()=>Qe(),children:e.jsx(Jt,{})}),ae&&e.jsx(ya,{chatflowid:w}),e.jsx(Gt,{isAgentCanvas:I,chatflowid:w})]})})})}),e.jsx(Yt,{})]})})};export{os as default};
