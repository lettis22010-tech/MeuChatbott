import{af as Ae,P as ge,a as De,p as $e,c as W,r,j as e,D as ht,h as ut,k as mt,S as Z,z as Ie,l as v,C as A,B as D,a1 as Fe,a7 as xt,aD as ft,a3 as ee,m as gt,a8 as ue,n as K,aa as vt,s as jt,R as pt,o as Ve,b as bt,E as me,M as wt,T as yt,e as ze,U as Ct,V as St,W as We,X as qe,O as he,L as y,Y as Je,u as Et,az as Be,aE as kt,ae as At,ac as X,J as Ue,K as Ge}from"./index-B1XR3Coy.js";import{m as je}from"./moment-9Y6NtRWJ.js";import{e as ve}from"./evaluations-JFnWKDjf.js";import{C as He,u as Xe}from"./ConfirmDialog-Bksga_et.js";import{B as Dt}from"./BackdropLoader-C982mQas.js";import{E as Mt}from"./ErrorBoundary-WOMkE_83.js";import{V as Nt}from"./ViewHeader-jo2V0q71.js";import{S as ke,a as d}from"./TableStyles-Bn4d_qd9.js";import{D as Ce}from"./Dropdown-BH_BuIwh.js";import{C as Lt}from"./CredentialInputHandler-NSWgGX5U.js";import{T as Rt}from"./TooltipWithParser-C72LCUcD.js";import{M as Se}from"./MultiDropdown-OnTaU3K-.js";import{c as Oe}from"./chatflows-ITLPd47E.js";import{d as Tt}from"./dataset-gYqR4wmQ.js";import{e as _t,I as Pt}from"./evaluators-KFcGfEtJ.js";import{n as Ye}from"./nodes-D-x6LTqi.js";import{a as It}from"./assistants-C-o7l-z6.js";import{e as Ft}from"./evaluatorConstant-DqyckRrE.js";import{I as zt}from"./IconAlertTriangle-Bdlxpe5D.js";import{D as Bt}from"./DialogContentText-DvhtFVvn.js";import{a as Ot}from"./IconSearch-BzBgax5m.js";import{S as Yt,a as $t,b as Vt}from"./Stepper-CvQjJ8b9.js";import{D as Wt,T as qt}from"./TablePagination-Dfhg7VLc.js";import{I as Jt}from"./IconRefresh-B2aTlEaU.js";import{I as Ut}from"./IconPlus-DpyX5kZB.js";import{I as Ke}from"./IconTrash-BvhWIQ6v.js";import{S as k}from"./Skeleton-BQAmmov-.js";import{I as Gt,a as Ht}from"./IconChevronsUp-iPfKij1q.js";import"./IconCopy-BBl1XuSo.js";import"./StyledFab-BqTal21_.js";import"./Autocomplete-2B99MXTa.js";import"./Close-CA_iFeNy.js";import"./FormControl-Cb0ROeST.js";import"./TextField-BEeUeVUl.js";import"./InputLabel-HPVYUEFn.js";import"./CredentialListDialog-ooDI7A-3.js";import"./Input-C2v4FwXn.js";import"./ListItem-C9nlU6HX.js";import"./Switch-BtbcRzr_.js";import"./main-BBsr8sqY.js";import"./IconArrowsMaximize-BrsSDZNx.js";import"./InputAdornment-D6_duzKN.js";import"./Tooltip-9ICsuaYn.js";import"./index-D--Rb2MU.js";import"./Pagination-DyTukyc1.js";import"./LastPage-CMvObEkB.js";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Xt=Ae("outline","chart-bar","IconChartBar",[["path",{d:"M3 13a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v6a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-0"}],["path",{d:"M15 9a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v10a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-1"}],["path",{d:"M9 5a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v14a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-2"}],["path",{d:"M4 20h14",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Kt=Ae("outline","player-pause","IconPlayerPause",[["path",{d:"M6 5m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v12a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z",key:"svg-0"}],["path",{d:"M14 5m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v12a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Qt=Ae("outline","player-play","IconPlayerPlay",[["path",{d:"M7 4v16l13 -8z",key:"svg-0"}]]);const Ee=["Datasets","Evaluators","LLM Graded Metrics"],Qe=({show:l,dialogProps:P,onCancel:te,onConfirm:I})=>{var Le,Re;const ae=document.getElementById("portal"),x=De();$e();const M=W(Oe.getAllChatflows),j=W(Oe.getAllAgentflows),C=W(Tt.getAllDatasets),F=W(_t.getAllEvaluators),L=W(Ye.getNodesByCategory),O=W(Ye.executeNodeLoadMethod),q=W(It.getAllAssistants),[S,J]=r.useState([]),[z,B]=r.useState(""),[Y,Q]=r.useState(!1),[u,R]=r.useState([]),[b,se]=r.useState([]),[T,ne]=r.useState([]),[E,_]=r.useState(""),[$,U]=r.useState(""),[le,G]=r.useState([]),[re,n]=r.useState([]),[w,f]=r.useState([]),[g,N]=r.useState([]),[m,a]=r.useState(0),[o,s]=r.useState(!1),[p,oe]=r.useState(!1),[ie,et]=r.useState([]),[H,xe]=r.useState("no_grading"),[pe,tt]=r.useState([]),[de,ce]=r.useState("");r.useEffect(()=>{if(P.type==="NEW"&&P.data){const t=P.data,i=[];JSON.parse(t.chatflowId).map(c=>{i.push(c)}),J(i),B(t.datasetId),_(""),ce(""),xe("no_grading"),U(""),f([]),N([]),a(0),s(!1),_("")}else Me();return()=>{Me()}},[P]);const Me=()=>{B(""),_(""),U(""),f([]),N([]),a(0),J([]),ce(""),xe("no_grading"),s(!1),Q(!1)},at=()=>m===0?$&&z&&S.length>0:m===1?!0:m===2?o?E&&H&&de:!0:!1,be=async t=>{const i=at();oe(!i),i&&(t===Ee.length-1?nt():a(c=>c+1))},st=async()=>{a(t=>t-1)},nt=async()=>{var Te,_e,Pe;const t=JSON.parse(S),i=[];for(let V=0;V<t.length;V+=1)i.push((Te=b.find(ye=>ye.name===t[V]))==null?void 0:Te.label);const c=[];for(let V=0;V<t.length;V+=1)c.push((_e=b.find(ye=>ye.name===t[V]))==null?void 0:_e.type);const h=JSON.stringify(i),fe=(Pe=T.find(V=>V.name===z))==null?void 0:Pe.label,dt={name:$,evaluationType:E?"llm":"benchmarking",credentialId:E,datasetId:z,datasetName:fe,chatflowId:S,chatflowName:h,chatflowType:JSON.stringify(c),selectedSimpleEvaluators:w,selectedLLMEvaluators:g,model:de,llm:H,datasetAsOneConversation:Y};I(dt)},lt=()=>{var t;if(m===0)return!$||!z||S.length===0;if(m===2)return!!(o&&(!de||!H||g.length===0||(t=ie.find(i=>i.name===H))!=null&&t.credential&&!E))},rt=()=>e.jsx(D,{sx:{width:"100%"},children:e.jsx(Yt,{activeStep:m,alternativeLabel:!0,children:Ee.map(t=>e.jsx($t,{children:e.jsx(Vt,{children:t})},t))})});r.useEffect(()=>{L.request("Chat Models"),b.length===0&&(M.request(),q.request("CUSTOM"),j.request("AGENTFLOW")),T.length===0&&C.request(),F.request()},[]),r.useEffect(()=>{if(j.data&&M.data&&q.data)try{const t=Ne(j.data,"Agentflow v2"),i=Ne(M.data,"Chatflow"),c=it(q.data);se([...t,...i,...c]),R(["Agentflow v2","Chatflow","Custom Assistant"])}catch(t){console.error(t)}},[j.data,M.data,q.data]),r.useEffect(()=>{if(L.data){const t=[];try{const i=L.data;t.push({label:"No Grading",name:"no_grading",credential:{}});for(let c=0;c<i.length;c+=1){const h=i[c];(!h.tags||!h.tags.indexOf("[LlamaIndex]")===-1)&&t.push({label:h.label,name:h.name,credential:h.credential})}et(t),xe("no_grading"),ce(""),_("")}catch(i){console.error(i)}}},[L.data]),r.useEffect(()=>{if(O.data)try{const t=O.data;tt(t)}catch(t){console.error(t)}},[O.data]),r.useEffect(()=>{if(F.data)try{const t=[],i=[];for(let c=0;c<F.data.length;c+=1){const h=F.data[c];h.label=h.name,h.name=h.id,h.type==="llm"?i.push(h):t.push(h)}G(t),n(i)}catch(t){console.error(t)}},[F.data]),r.useEffect(()=>{if(C.data)try{const t=C.data;let i=[];for(let c=0;c<t.length;c+=1){const h=t[c];i.push({label:h.name,name:h.id})}ne(i)}catch(t){console.error(t)}},[C.data]);const ot=t=>{s(t!=="no_grading"),xe(t),ce(""),_(""),t!=="no_grading"&&O.request(t,{loadMethod:"listModels"})},we=t=>{const i=t.target.checked,c=t.target.value;R(i?[...u,c]:u.filter(h=>h!==c))},Ne=(t,i)=>{let c=[];for(let h=0;h<t.length;h+=1){const fe=t[h];c.push({label:fe.name,name:fe.id,type:i,description:i})}return c},it=t=>{let i=[];for(let c=0;c<t.length;c+=1){const h=t[c];i.push({label:JSON.parse(h.details).name||"",name:h.id,type:"Custom Assistant",description:"Custom Assistant"})}return i},ct=l?e.jsxs(ht,{fullWidth:!0,maxWidth:"md",open:l,onClose:te,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(ut,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(Pt,{style:{marginRight:"10px"}}),"Start New Evaluation"]})}),e.jsx(mt,{children:e.jsxs(Z,{direction:"column",spacing:2,children:[e.jsx(Ie,{}),p&&e.jsxs("div",{style:{display:"flex",minHeight:40,flexDirection:"row",alignItems:"center",backgroundColor:"lightcoral",color:"white",padding:10},children:[e.jsx("div",{style:{width:25,height:25,marginRight:10,borderRadius:"50%"},children:e.jsx(zt,{style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"contain"}})}),"Fill all the mandatory fields"]}),e.jsx(rt,{}),e.jsxs(Bt,{align:"center",children:[m===0&&e.jsxs(e.Fragment,{children:[e.jsx(v,{sx:{mt:2},variant:"h4",children:"Select dataset to be tested on flows"}),e.jsxs(v,{sx:{mt:2},variant:"body2",children:["Uses the ",e.jsx("span",{style:{fontStyle:"italic"},children:"input"})," column from the dataset to execute selected Chatflow(s), and compares the results with the output column."]}),e.jsx(v,{variant:"body2",children:"The following metrics will be computed:"}),e.jsx(Z,{flexDirection:"row",sx:{mt:2,gap:1,alignItems:"center",justifyContent:"center",flexWrap:"wrap"},children:Ft.filter(t=>t.type==="numeric"&&t.name!=="chain").map((t,i)=>e.jsx(A,{variant:"outlined",label:t.label},i))})]}),m===1&&e.jsxs(e.Fragment,{children:[e.jsx(v,{sx:{mt:2},variant:"h4",children:"Unit Test your flows by adding custom evaluators"}),e.jsx(v,{sx:{mt:2,mb:2},variant:"body2",children:"Post execution, all the chosen evaluators will be executed on the results. Each evaluator will grade the results based on the criteria defined and return a pass/fail indicator."}),e.jsx(A,{variant:"contained",color:"success",sx:{background:x.palette.teal.main,color:"white"},label:"pass"}),e.jsx(A,{variant:"contained",color:"error",style:{margin:5},label:"fail"})]}),m===2&&e.jsxs(e.Fragment,{children:[e.jsx(v,{sx:{mt:2},variant:"h4",children:"Grade flows using an LLM"}),e.jsx(v,{sx:{mt:2},variant:"body2",children:"Post execution, grades the answers by using an LLM. Used to generate comparative scores or reasoning or other custom defined criteria."})]})]}),m===0&&e.jsxs(e.Fragment,{children:[e.jsxs(D,{children:[e.jsxs(v,{variant:"overline",children:["Name",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx(Rt,{style:{marginLeft:10},title:"Friendly name to tag this run."}),e.jsx(Fe,{id:"evaluationName",type:"string",size:"small",fullWidth:!0,placeholder:"Evaluation",value:$,name:"evaluationName",onChange:t=>U(t.target.value)})]}),e.jsxs(D,{children:[e.jsxs(v,{variant:"overline",children:["Dataset to use",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx(Ce,{name:"dataset",defaultOption:"Select Dataset",options:T,onSelect:t=>B(t),value:z})]}),e.jsxs(D,{children:[e.jsx(v,{variant:"overline",sx:{mr:2},children:"Treat all dataset rows as one conversation ?"}),e.jsx(xt,{label:"",control:e.jsx(ft,{}),value:Y,onChange:()=>Q(!Y)})]}),e.jsxs(D,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(v,{variant:"overline",children:["Select your flows to Evaluate",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsxs(v,{variant:"overline",children:[e.jsx(ee,{defaultChecked:!0,size:"small",label:"All",value:"Chatflow",onChange:we})," ","Chatflows",e.jsx(ee,{defaultChecked:!0,size:"small",label:"All",value:"Agentflow v2",onChange:we})," ","Agentflows (v2)",e.jsx(ee,{defaultChecked:!0,size:"small",label:"All",value:"Custom Assistant",onChange:we})," ","Custom Assistants"]})]}),e.jsx(Se,{name:"chatflow1",options:b.filter(t=>u.includes(t.type)),onSelect:t=>J(t),value:S??S??"choose an option"})]})]}),m===1&&e.jsx(e.Fragment,{children:e.jsxs(D,{children:[e.jsx(v,{variant:"overline",children:"Select the Evaluators"}),e.jsx(Se,{name:"selectEvals",options:le,onSelect:t=>f(t),value:w})]})}),m===2&&e.jsxs(e.Fragment,{children:[e.jsxs(D,{children:[e.jsx(v,{variant:"overline",sx:{mr:2},children:"Use an LLM to grade the results ?"}),e.jsx(Ce,{name:"chatLLM",defaultOption:"no_grading",options:ie,value:H,onSelect:t=>ot(t)})]}),o&&pe.length>0&&e.jsxs(D,{children:[e.jsx(v,{variant:"overline",children:"Select Model"}),e.jsx(Ce,{name:"selectedModel",defaultOption:"",options:pe,value:de,onSelect:t=>ce(t)})]}),o&&pe.length===0&&e.jsxs(D,{children:[e.jsx(v,{variant:"overline",children:"Enter the Model Name"}),e.jsx(Fe,{id:"selectedModel",type:"string",size:"small",fullWidth:!0,placeholder:"Model Name",value:de,name:"selectedModel",onChange:t=>ce(t.target.value)})]}),o&&((Le=ie.find(t=>t.name===H))==null?void 0:Le.credential)&&e.jsxs(D,{children:[e.jsx(v,{variant:"overline",children:"Select Credential"}),e.jsx(Lt,{size:"small",sx:{flexGrow:1,marginBottom:3},data:E?{credential:E}:{},inputParam:{label:"Connect Credential",name:"credential",type:"credential",credentialNames:[(Re=ie.find(t=>t.name===H))==null?void 0:Re.credential.credentialNames[0]]},onSelect:t=>{_(t)}},H)]}),o&&e.jsxs(D,{children:[e.jsx(v,{variant:"overline",children:"Select Evaluators"}),e.jsx(Se,{name:"selectLLMEvals",options:re,onSelect:t=>N(t),value:g})]})]}),e.jsx(Ie,{})]})}),e.jsxs(gt,{style:{justifyContent:"space-between",marginBottom:10},children:[m>0&&e.jsx(ue,{sx:{ml:2},color:"secondary",title:"Previous Step",onClick:()=>st(),children:e.jsx(Ot,{})}),e.jsx("div",{style:{flex:1}}),m===1&&w.length===0&&e.jsx(K,{title:"Skip Evaluators",color:"primary",sx:{mr:2,borderRadius:25},variant:"outlined",onClick:()=>be(m),children:"Skip"}),m===1&&w.length>0&&e.jsx(K,{color:"primary",sx:{mr:2,borderRadius:25},variant:"contained",onClick:()=>be(m),children:"Next"}),m!==1&&e.jsx(vt,{disabled:lt(),sx:{mr:2,borderRadius:25},variant:"contained",onClick:()=>be(m),children:m===Ee.length-1?"Start Evaluation":"Next"})]}),e.jsx(He,{})]}):null;return jt.createPortal(ct,ae)};Qe.propTypes={show:ge.bool,dialogProps:ge.object,onCancel:ge.func,onConfirm:ge.func};const Zt="/assets/empty_evals-ClL3epFs.svg",Ja=()=>{const l=De(),P=pt(a=>a.customization),{confirm:te}=Xe(),I=Ve();$e();const{error:ae}=bt(),x=(...a)=>I(Ue(...a)),M=(...a)=>I(Ge(...a)),j=W(ve.createEvaluation),C=W(ve.getAllEvaluations),[F,L]=r.useState(!1),[O,q]=r.useState({}),[S,J]=r.useState([]),[z,B]=r.useState(!1),[Y,Q]=r.useState(!1),[u,R]=r.useState([]),[b,se]=r.useState(!1),[T,ne]=r.useState(1),[E,_]=r.useState(Wt),[$,U]=r.useState(0),le=(a,o)=>{ne(a),_(o),G(a,o)},G=(a,o)=>{const s={page:a||T,limit:o||E};C.request(s)},re=a=>{if(a.target.checked){const o=S.filter(s=>s==null?void 0:s.latestEval).map(s=>s.id);R(o);return}R([])},n=(a,o)=>{const s=u.indexOf(o);let p=[];s===-1?p=p.concat(u,o):s===0?p=p.concat(u.slice(1)):s===u.length-1?p=p.concat(u.slice(0,-1)):s>0&&(p=p.concat(u.slice(0,s),u.slice(s+1))),R(p)},w=()=>{q({type:"ADD",cancelButtonName:"Cancel",confirmButtonName:"Start New Evaluation",data:{}}),L(!0)},f=async()=>{const a={title:"Delete",description:`Delete ${u.length} ${u.length>1?"evaluations":"evaluation"}? This will delete all versions of the evaluation.`,confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await te(a)){try{(await ve.deleteEvaluations(u,!0)).data&&(x({message:`${u.length} ${u.length>1?"evaluations":"evaluation"} deleted`,options:{key:new Date().getTime()+Math.random(),variant:"success",action:oe=>e.jsx(K,{style:{color:"white"},onClick:()=>M(oe),children:e.jsx(me,{})})}}),N())}catch(s){x({message:`Failed to delete ${u.length>1?"evaluations":"evaluation"}: ${typeof s.response.data=="object"?s.response.data.message:s.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:p=>e.jsx(K,{style:{color:"white"},onClick:()=>M(p),children:e.jsx(me,{})})}})}R([])}};r.useEffect(()=>{G(T,E)},[]),r.useEffect(()=>{if(C.data){const a=C.data.data;if(U(C.data.total),a){for(let o=0;o<a.length;o++){const s=a[o];a[o].runDate=je(s.runDate).format("DD-MMM-YYYY, hh:mm:ss A"),a[o].average_metrics=typeof s.average_metrics=="object"?s.average_metrics:JSON.parse(s.average_metrics),a[o].usedFlows=typeof s.chatflowName=="object"?s.chatflowName:JSON.parse(s.chatflowName),a[o].chatIds=typeof s.chatflowId=="object"?s.chatflowId:JSON.parse(s.chatflowId)}J(a)}}},[C.data]),r.useEffect(()=>{if(j.data){const a=j.data;for(let o=0;o<a.length;o++){const s=a[o];a[o].runDate=je(s.runDate).format("DD-MMM-YYYY, hh:mm:ss A"),a[o].average_metrics=typeof s.average_metrics=="object"?s.average_metrics:JSON.parse(s.average_metrics),a[o].usedFlows=typeof s.chatflowName=="object"?s.chatflowName:JSON.parse(s.chatflowName),a[o].chatIds=typeof s.chatflowId=="object"?s.chatflowId:JSON.parse(s.chatflowId)}J(a)}B(!1)},[j.data]);const g=a=>{L(!1),B(!0),j.request(a)};r.useEffect(()=>{var a,o;j.error&&(x({message:`Failed to create new evaluation: ${typeof((a=j.error.response)==null?void 0:a.data)=="object"?j.error.response.data.message:((o=j.error.response)==null?void 0:o.data)||j.error.message||"Unknown error"}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:s=>e.jsx(K,{style:{color:"white"},onClick:()=>M(s),children:e.jsx(me,{})})}}),B(!1))},[j.error]);const N=r.useCallback(()=>{G(T,E)},[C]);r.useEffect(()=>{Q(C.loading)},[C.loading]),r.useEffect(()=>{let a=null;return b&&(a=setInterval(()=>{N()},5e3)),()=>{a&&clearInterval(a)}},[b,N]);const m=()=>{se(!b)};return e.jsxs(e.Fragment,{children:[e.jsx(wt,{children:ae?e.jsx(Mt,{error:ae}):e.jsxs(Z,{flexDirection:"column",sx:{gap:3},children:[e.jsxs(Nt,{isBackButton:!1,isEditButton:!1,search:!1,title:"Evaluations",description:"",children:[e.jsx(yt,{value:"auto-refresh",selected:b,onChange:m,size:"small",sx:{borderRadius:2,height:"100%",backgroundColor:"transparent",color:b?"#ff9800":"#4caf50",border:"1px solid transparent","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)",color:b?"#f57c00":"#388e3c",border:"1px solid transparent"},"&.Mui-selected":{backgroundColor:"transparent",color:"#ff9800",border:"1px solid transparent","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)",color:"#f57c00",border:"1px solid transparent"}}},title:b?"Disable auto-refresh":"Enable auto-refresh (every 5s)",children:b?e.jsx(Kt,{}):e.jsx(Qt,{})}),e.jsx(ue,{sx:{borderRadius:2,height:"100%",color:l.palette.secondary.main,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)",color:l.palette.secondary.dark}},onClick:N,title:"Refresh",children:e.jsx(Jt,{})}),e.jsx(ze,{permissionId:"evaluations:create",sx:{borderRadius:2,height:"100%"},onClick:w,startIcon:e.jsx(Ut,{}),children:"New Evaluation"})]}),u.length>0&&e.jsxs(ze,{permissionId:"evaluations:delete",sx:{mt:1,mb:2,width:"max-content"},variant:"outlined",onClick:f,color:"error",startIcon:e.jsx(Ke,{}),children:["Delete ",u.length," ",u.length===1?"evaluation":"evaluations"]}),!Y&&S.length<=0?e.jsxs(Z,{sx:{alignItems:"center",justifyContent:"center"},flexDirection:"column",children:[e.jsx(D,{sx:{p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"20vh",width:"auto"},src:Zt,alt:"empty_evalSVG"})}),e.jsx("div",{children:"No Evaluations Yet"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ct,{sx:{border:1,borderColor:l.palette.grey[900]+25,borderRadius:2},component:St,children:e.jsxs(We,{sx:{minWidth:650},children:[e.jsx(qe,{sx:{backgroundColor:P.isDarkMode?l.palette.common.black:l.palette.grey[100],height:56},children:e.jsxs(he,{children:[e.jsx(y,{padding:"checkbox",children:e.jsx(ee,{color:"primary",checked:u.length===(S.filter(a=>a==null?void 0:a.latestEval)||[]).length,onChange:re,inputProps:{"aria-label":"select all"}})}),e.jsx(y,{width:10,children:" "}),e.jsx(y,{children:"Name"}),e.jsx(y,{children:"Latest Version"}),e.jsx(y,{children:"Average Metrics"}),e.jsx(y,{children:"Last Evaluated"}),e.jsx(y,{children:"Flow(s)"}),e.jsx(y,{children:"Dataset"}),e.jsx(y,{children:" "})]})}),e.jsx(Je,{children:Y?e.jsxs(e.Fragment,{children:[e.jsxs(ke,{children:[e.jsx(d,{children:e.jsx(k,{variant:"text"})}),e.jsx(d,{children:e.jsx(k,{variant:"text"})}),e.jsx(d,{children:e.jsx(k,{variant:"text"})}),e.jsx(d,{children:e.jsx(k,{variant:"text"})}),e.jsx(d,{children:e.jsx(k,{variant:"text"})}),e.jsx(d,{children:e.jsx(k,{variant:"text"})}),e.jsx(d,{children:e.jsx(k,{variant:"text"})})]}),e.jsxs(ke,{children:[e.jsx(d,{children:e.jsx(k,{variant:"text"})}),e.jsx(d,{children:e.jsx(k,{variant:"text"})}),e.jsx(d,{children:e.jsx(k,{variant:"text"})}),e.jsx(d,{children:e.jsx(k,{variant:"text"})}),e.jsx(d,{children:e.jsx(k,{variant:"text"})}),e.jsx(d,{children:e.jsx(k,{variant:"text"})}),e.jsx(d,{children:e.jsx(k,{variant:"text"})})]})]}):e.jsx(e.Fragment,{children:S.filter(a=>a==null?void 0:a.latestEval).map((a,o)=>e.jsx(Ze,{rows:S.filter(s=>s.name===a.name),item:a,theme:l,selected:u,customization:P,onRefresh:N,handleSelect:n},o))})})]})}),e.jsx(qt,{currentPage:T,limit:E,total:$,onChange:le})]})]})}),F&&e.jsx(Qe,{show:F,dialogProps:O,onCancel:()=>L(!1),onConfirm:g}),e.jsx(He,{}),z&&e.jsx(Dt,{open:z})]})};function Ze(l){var Q,u,R,b,se,T,ne,E,_,$,U,le,G,re;const P=(...n)=>L(Ue(...n)),te=(...n)=>L(Ge(...n)),[I,ae]=r.useState(!1),[x,M]=r.useState([]),j=De(),C=Et(),{confirm:F}=Xe(),L=Ve(),O=n=>{C(`/evaluation_results/${n.id}`)},q=n=>{window.open(`/dataset_rows/${n}`,"_blank")},S=n=>{if(n.target.checked){const w=((l==null?void 0:l.rows)||[]).map(f=>f.id);M(w);return}M([])},J=(n,w)=>{const f=x.indexOf(w);let g=[];f===-1?g=g.concat(x,w):f===0?g=g.concat(x.slice(1)):f===x.length-1?g=g.concat(x.slice(0,-1)):f>0&&(g=g.concat(x.slice(0,f),x.slice(f+1))),M(g)},z=async()=>{const n={title:"Delete",description:`Delete ${x.length} ${x.length>1?"evaluations":"evaluation"}?`,confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await F(n))try{(await ve.deleteEvaluations(x)).data&&(P({message:`${x.length} evaluations deleted.`,options:{key:new Date().getTime()+Math.random(),variant:"success",action:g=>e.jsx(K,{style:{color:"white"},onClick:()=>te(g),children:e.jsx(me,{})})}}),l.onRefresh())}catch(f){P({message:`Failed to delete Evaluation: ${typeof f.response.data=="object"?f.response.data.message:f.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:g=>e.jsx(K,{style:{color:"white"},onClick:()=>te(g),children:e.jsx(me,{})})}})}},B=n=>{switch(n){case"pending":return"#ffc107";case"completed":return"#52b69a";case"error":return"#f44336";default:return"#bcbcbc"}},Y=n=>n>90?"#52b69a":n>=50?"#f48c06":"#f44336";return e.jsxs(Be.Fragment,{children:[e.jsxs(ke,{children:[e.jsx(d,{padding:"checkbox",children:e.jsx(ee,{color:"primary",checked:l.selected.indexOf(l.item.id)!==-1,onChange:n=>l.handleSelect(n,l.item.id)})}),e.jsx(d,{children:e.jsx("div",{style:{display:"flex",width:"20px",height:"20px",backgroundColor:B(l.item.status),borderRadius:"50%"},title:((Q=l.item)==null?void 0:Q.status)==="error"?(R=(u=l.item)==null?void 0:u.average_metrics)==null?void 0:R.error:""})}),e.jsx(d,{children:l.item.name}),e.jsxs(d,{children:[l.item.version," ",l.item.version>0&&e.jsx(ue,{"aria-label":"expand row",size:"small",color:"inherit",onClick:()=>ae(!I),children:l.item.version>0&&I?e.jsx(Gt,{}):e.jsx(Ht,{})})]}),e.jsx(d,{children:e.jsxs(Z,{flexDirection:"row",sx:{gap:1,alignItems:"center",flexWrap:"wrap"},children:[e.jsx(A,{variant:"outlined",size:"small",color:"info",label:(b=l.item.average_metrics)!=null&&b.totalRuns?"Total Runs: "+((se=l.item.average_metrics)==null?void 0:se.totalRuns):"Total Runs: N/A"}),((T=l.item.average_metrics)==null?void 0:T.averageCost)&&e.jsx(A,{variant:"outlined",size:"small",color:"info",label:(ne=l.item.average_metrics)==null?void 0:ne.averageCost}),e.jsx(A,{variant:"outlined",size:"small",color:"info",label:(E=l.item.average_metrics)!=null&&E.averageLatency?"Avg Latency: "+((_=l.item.average_metrics)==null?void 0:_.averageLatency)+"ms":"Avg Latency: N/A"}),(($=l.item.average_metrics)==null?void 0:$.passPcnt)>=0&&e.jsx(A,{variant:"raised",size:"small",sx:{color:"white",backgroundColor:Y((U=l.item.average_metrics)==null?void 0:U.passPcnt)},label:(le=l.item.average_metrics)!=null&&le.passPcnt?"Pass Rate: "+l.item.average_metrics.passPcnt+"%":"Pass Rate: N/A"})]})}),e.jsx(d,{children:je(l.item.runDate).format("DD-MMM-YYYY, hh:mm:ss A")}),e.jsx(d,{children:e.jsx(Z,{flexDirection:"row",sx:{gap:2,alignItems:"center",flexWrap:"wrap"},children:(re=(G=l.item)==null?void 0:G.usedFlows)==null?void 0:re.map((n,w)=>e.jsx(A,{style:{width:"max-content",borderRadius:"25px"},label:n},w))})}),e.jsx(d,{children:e.jsx(A,{clickable:!0,style:{border:"none",width:"max-content",borderRadius:"25px",boxShadow:l.customization.isDarkMode?"0 2px 14px 0 rgb(255 255 255 / 10%)":"0 2px 14px 0 rgb(32 40 45 / 10%)"},variant:"outlined",label:l.item.datasetName,onClick:()=>q(l.item.datasetId)})}),e.jsx(y,{children:e.jsx(ue,{title:"View Results",color:"primary",disabled:l.item.status==="pending",onClick:()=>O(l.item),children:e.jsx(kt,{})})})]}),I&&x.length>0&&e.jsx(he,{sx:{"& td":{border:0}},children:e.jsx(d,{colSpan:12,children:e.jsxs(K,{sx:{mt:2,width:"max-content"},variant:"outlined",onClick:z,color:"error",startIcon:e.jsx(Ke,{}),children:["Delete ",x.length," ",x.length===1?"evaluation":"evaluations"]})})}),I&&e.jsx(e.Fragment,{children:e.jsx(he,{sx:{"& td":{border:0}},children:e.jsx(d,{colSpan:12,sx:{p:2},children:e.jsx(At,{in:I,timeout:"auto",unmountOnExit:!0,children:e.jsx(D,{sx:{borderRadius:2,border:1,borderColor:j.palette.grey[900]+25,overflow:"hidden"},children:e.jsxs(We,{"aria-label":"chatflow table",children:[e.jsx(qe,{style:{height:10},children:e.jsxs(he,{children:[e.jsx(y,{padding:"checkbox",children:e.jsx(ee,{color:"primary",checked:x.length===(l.rows||[]).length,onChange:S})}),e.jsx(y,{children:"Version"}),e.jsx(y,{children:"Last Run"}),e.jsx(y,{children:"Average Metrics"}),e.jsx(y,{children:"Status"}),e.jsx(y,{children:" "})]})}),e.jsx(Je,{children:l.rows.length>0&&l.rows.map((n,w)=>{var f,g,N,m,a,o,s,p,oe;return e.jsx(Be.Fragment,{children:e.jsxs(he,{sx:{"& td":{border:0}},children:[e.jsx(d,{padding:"checkbox",children:e.jsx(ee,{color:"primary",checked:x.indexOf(n.id)!==-1,onChange:ie=>J(ie,n.id)})}),e.jsx(d,{children:n.version}),e.jsx(d,{children:je(n.runDate).format("DD-MMM-YYYY, hh:mm:ss A")}),e.jsx(d,{children:e.jsxs(Z,{flexDirection:"row",sx:{gap:1,alignItems:"center",flexWrap:"wrap"},children:[e.jsx(A,{variant:"outlined",size:"small",color:"info",label:(f=n.average_metrics)!=null&&f.totalRuns?"Total Runs: "+((g=n.average_metrics)==null?void 0:g.totalRuns):"Total Runs: N/A"}),((N=n.average_metrics)==null?void 0:N.averageCost)&&e.jsx(A,{variant:"outlined",size:"small",color:"info",label:(m=n.average_metrics)==null?void 0:m.averageCost}),e.jsx(A,{variant:"outlined",size:"small",color:"info",label:(a=n.average_metrics)!=null&&a.averageLatency?"Avg Latency: "+((o=n.average_metrics)==null?void 0:o.averageLatency)+"ms":"Avg Latency: N/A"}),((s=n.average_metrics)==null?void 0:s.passPcnt)>=0&&e.jsx(A,{variant:"raised",size:"small",sx:{color:"white",backgroundColor:Y((p=n.average_metrics)==null?void 0:p.passPcnt)},label:(oe=n.average_metrics)!=null&&oe.passPcnt?"Pass rate: "+n.average_metrics.passPcnt+"%":"Pass rate: N/A"})]})}),e.jsx(d,{children:e.jsx(A,{variant:"contained",size:"small",sx:{color:"white",backgroundColor:B(n.status)},label:n.status,title:n.status==="error"?n.average_metrics.error:""})}),e.jsx(d,{children:e.jsx(ue,{title:"View Results",color:"primary",disabled:n.status==="pending",onClick:()=>O(n),children:e.jsx(Xt,{})})})]})},w)})})]})})})})})})]})}Ze.propTypes={item:X.object,selected:X.array,rows:X.arrayOf(X.object),theme:X.any,customization:X.object,onRefresh:X.func,handleSelect:X.func};export{Ja as default};
