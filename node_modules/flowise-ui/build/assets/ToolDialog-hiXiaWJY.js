import{af as Y,P as c,s as H,j as e,D as _,h as V,k as K,r as i,B as p,n as l,m as ne,aa as ie,b4 as $,R as De,o as Ie,p as Ce,c as Ee,q as ke,H as te,c0 as B,ad as oe,S as w,l as M,a1 as U,e as se,a6 as Ae,aq as ae,E as g,c1 as Me,J as Ne,K as $e}from"./index-B1XR3Coy.js";import{G as Oe}from"./Grid-DtMOPoeK.js";import{T as L}from"./TooltipWithParser-C72LCUcD.js";import{d as Re}from"./Delete-CvnCkEIf.js";import{u as Fe,C as Je}from"./ConfirmDialog-Bksga_et.js";import{C as re}from"./CodeEditor-BjDzi2Vy.js";import{E as Be}from"./ExportAsTemplateDialog-CN3tapJC.js";import{G as Le}from"./GridActionsCellItem-C4fgcfe6.js";import{I as qe}from"./IconPlus-DpyX5kZB.js";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var We=Y("outline","code","IconCode",[["path",{d:"M7 8l-4 4l4 4",key:"svg-0"}],["path",{d:"M17 8l4 4l-4 4",key:"svg-1"}],["path",{d:"M14 4l-4 16",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ze=Y("outline","file-download","IconFileDownload",[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z",key:"svg-1"}],["path",{d:"M12 17v-6",key:"svg-2"}],["path",{d:"M9.5 14.5l2.5 2.5l2.5 -2.5",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ge=Y("outline","template","IconTemplate",[["path",{d:"M4 4m0 1a1 1 0 0 1 1 -1h14a1 1 0 0 1 1 1v2a1 1 0 0 1 -1 1h-14a1 1 0 0 1 -1 -1z",key:"svg-0"}],["path",{d:"M4 12m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v6a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-1"}],["path",{d:"M14 12l6 0",key:"svg-2"}],["path",{d:"M14 16l6 0",key:"svg-3"}],["path",{d:"M14 20l6 0",key:"svg-4"}]]);const le=({show:a,onCancel:t})=>{const S=document.getElementById("portal"),h=a?e.jsxs(_,{onClose:t,open:a,fullWidth:!0,maxWidth:"sm","aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(V,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:"How To Use Function"}),e.jsx(K,{children:e.jsxs("ul",{children:[e.jsx("li",{style:{marginTop:10},children:"You can use any libraries imported in Flowise"}),e.jsxs("li",{style:{marginTop:10},children:["You can use properties specified in Input Schema as variables with prefix $:",e.jsxs("ul",{style:{marginTop:10},children:[e.jsxs("li",{children:["Property = ",e.jsx("code",{children:"userid"})]}),e.jsxs("li",{children:["Variable = ",e.jsx("code",{children:"$userid"})]})]})]}),e.jsxs("li",{style:{marginTop:10},children:["You can get default flow config:",e.jsxs("ul",{style:{marginTop:10},children:[e.jsx("li",{children:e.jsx("code",{children:"$flow.sessionId"})}),e.jsx("li",{children:e.jsx("code",{children:"$flow.chatId"})}),e.jsx("li",{children:e.jsx("code",{children:"$flow.chatflowId"})}),e.jsx("li",{children:e.jsx("code",{children:"$flow.input"})}),e.jsx("li",{children:e.jsx("code",{children:"$flow.state"})})]})]}),e.jsxs("li",{style:{marginTop:10},children:["You can get custom variables: ",e.jsx("code",{children:"$vars.<variable-name>"})]}),e.jsx("li",{style:{marginTop:10},children:"Must return a string value at the end of function"})]})})]}):null;return H.createPortal(h,S)};le.propTypes={show:c.bool,onCancel:c.func};const ce=({show:a,onCancel:t,onConfirm:S,customization:h})=>{const D=document.getElementById("portal"),[I,O]=i.useState(""),[C,u]=i.useState(""),q=()=>{try{const n=JSON.parse(I);if(!Array.isArray(n))throw new Error("Input must be an array of properties");const E=n.map((j,f)=>({id:f+1,property:j.property||"",type:j.type||"string",description:j.description||"",required:j.required||!1}));S(E),u("")}catch{u("Invalid JSON format. Please check your input.")}},m=`[
    {
        "property": "name",
        "type": "string",
        "description": "User's name",
        "required": true
    },
    {
        "property": "age",
        "type": "number",
        "description": "User's age",
        "required": false
    }
]`,x=a?e.jsxs(_,{fullWidth:!0,maxWidth:"md",open:a,onClose:t,"aria-labelledby":"paste-json-dialog-title",children:[e.jsx(V,{sx:{fontSize:"1rem"},id:"paste-json-dialog-title",children:"Paste JSON Schema"}),e.jsx(K,{children:e.jsxs(p,{sx:{mt:2},children:[e.jsx(l,{variant:"outlined",size:"small",onClick:()=>O(m),sx:{mb:2},children:"See Example"}),e.jsx(re,{value:I,theme:h.isDarkMode?"dark":"light",lang:"json",onValueChange:n=>{O(n),u("")}}),C&&e.jsx(p,{sx:{color:"error.main",mt:1,fontSize:"0.875rem"},children:C})]})}),e.jsxs(ne,{children:[e.jsx(l,{onClick:t,children:"Cancel"}),e.jsx(ie,{variant:"contained",onClick:q,children:"Confirm"})]})]}):null;return H.createPortal(x,D)};ce.propTypes={show:c.bool,onCancel:c.func,onConfirm:c.func,customization:c.object};const Ue=a=>$.get("/tools",{params:a}),Ye=a=>$.get(`/tools/${a}`),He=a=>$.post("/tools",a),_e=(a,t)=>$.put(`/tools/${a}`,t),Ve=a=>$.delete(`/tools/${a}`),N={getAllTools:Ue,getSpecificTool:Ye,createNewTool:He,updateTool:_e,deleteTool:Ve},Ke=`/*
* You can use any libraries imported in Flowise
* You can use properties specified in Input Schema as variables. Ex: Property = userid, Variable = $userid
* You can get default flow config: $flow.sessionId, $flow.chatId, $flow.chatflowId, $flow.input, $flow.state
* You can get custom variables: $vars.<variable-name>
* Must return a string value at the end of function
*/

const fetch = require('node-fetch');
const url = 'https://api.open-meteo.com/v1/forecast?latitude=52.52&longitude=13.41&current_weather=true';
const options = {
    method: 'GET',
    headers: {
        'Content-Type': 'application/json'
    }
};
try {
    const response = await fetch(url, options);
    const text = await response.text();
    return text;
} catch (error) {
    console.error(error);
    return '';
}`,Xe=({show:a,dialogProps:t,onUseTemplate:S,onCancel:h,onConfirm:D,setError:I})=>{const O=document.getElementById("portal"),C=De(o=>o.customization),u=Ie();Ce();const{confirm:q}=Fe(),m=(...o)=>u(Ne(...o)),x=(...o)=>u($e(...o)),n=Ee(N.getSpecificTool),[E,j]=i.useState(""),[f,v]=i.useState(""),[k,b]=i.useState(""),[R,A]=i.useState(""),[F,y]=i.useState([]),[J,d]=i.useState(""),[de,X]=i.useState(!1),[Q,Z]=i.useState(!1),[pe,ue]=i.useState({}),[P,W]=i.useState(!1),ee=i.useCallback(o=>()=>{setTimeout(()=>{y(s=>s.filter(r=>r.id!==o))})},[]),he=()=>{setTimeout(()=>{y(o=>{let s=[...ae.cloneDeep(o)];const r=s.length?s[s.length-1].id+1:1;return s.push({id:r,property:"",description:"",type:"",required:!1}),s})})},me=()=>{ue({title:"Export As Template",tool:{name:f,description:k,iconSrc:R,schema:F,func:J}}),Z(!0)},xe=o=>{setTimeout(()=>{y(s=>{let r=[...ae.cloneDeep(s)];const T=r.findIndex(z=>z.id===o.id);return T>=0&&(r[T]={...o}),r})})},fe=i.useMemo(()=>[{field:"property",headerName:"Property",editable:!0,flex:1},{field:"type",headerName:"Type",type:"singleSelect",valueOptions:["string","number","boolean","date"],editable:!0,width:120},{field:"description",headerName:"Description",editable:!0,flex:1},{field:"required",headerName:"Required",type:"boolean",editable:!0,width:80},{field:"actions",type:"actions",width:80,getActions:o=>[e.jsx(Le,{icon:e.jsx(Re,{}),label:"Delete",onClick:ee(o.id)},"Delete")]}],[ee]);i.useEffect(()=>(u(a?{type:ke}:{type:te}),()=>u({type:te})),[a,u]),i.useEffect(()=>{n.data&&(j(n.data.id),v(n.data.name),b(n.data.description),y(B(n.data.schema)),n.data.func?d(n.data.func):d(""))},[n.data]),i.useEffect(()=>{n.error&&I&&I(n.error)},[n.error]),i.useEffect(()=>{t.type==="EDIT"&&t.data?(j(t.data.id),v(t.data.name),b(t.data.description),A(t.data.iconSrc),y(B(t.data.schema)),t.data.func?d(t.data.func):d("")):t.type==="EDIT"&&t.toolId?n.request(t.toolId):t.type==="IMPORT"&&t.data?(v(t.data.name),b(t.data.description),A(t.data.iconSrc),y(B(t.data.schema)),t.data.func?d(t.data.func):d("")):t.type==="TEMPLATE"&&t.data?(v(t.data.name),b(t.data.description),A(t.data.iconSrc),y(B(t.data.schema)),t.data.func?d(t.data.func):d("")):t.type==="ADD"&&(j(""),v(""),b(""),A(""),y([]),d(""))},[t]);const ye=()=>{S(t.data)},je=async()=>{try{const o=await N.getSpecificTool(E);if(o.data){const s=o.data;delete s.id,delete s.createdDate,delete s.updatedDate;let r=JSON.stringify(s,null,2);const T=new Blob([r],{type:"application/json"}),z=URL.createObjectURL(T);let Se=`${f}-CustomTool.json`,G=document.createElement("a");G.setAttribute("href",z),G.setAttribute("download",Se),G.click()}}catch(o){m({message:`Failed to export Tool: ${typeof o.response.data=="object"?o.response.data.message:o.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:s=>e.jsx(l,{style:{color:"white"},onClick:()=>x(s),children:e.jsx(g,{})})}}),h()}},Te=async()=>{try{const o={name:f,description:k,color:Me(),schema:JSON.stringify(F),func:J,iconSrc:R},s=await N.createNewTool(o);s.data&&(m({message:"New Tool added",options:{key:new Date().getTime()+Math.random(),variant:"success",action:r=>e.jsx(l,{style:{color:"white"},onClick:()=>x(r),children:e.jsx(g,{})})}}),D(s.data.id))}catch(o){m({message:`Failed to add new Tool: ${typeof o.response.data=="object"?o.response.data.message:o.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:s=>e.jsx(l,{style:{color:"white"},onClick:()=>x(s),children:e.jsx(g,{})})}}),h()}},we=async()=>{try{const o=await N.updateTool(E,{name:f,description:k,schema:JSON.stringify(F),func:J,iconSrc:R});o.data&&(m({message:"Tool saved",options:{key:new Date().getTime()+Math.random(),variant:"success",action:s=>e.jsx(l,{style:{color:"white"},onClick:()=>x(s),children:e.jsx(g,{})})}}),D(o.data.id))}catch(o){m({message:`Failed to save Tool: ${typeof o.response.data=="object"?o.response.data.message:o.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:s=>e.jsx(l,{style:{color:"white"},onClick:()=>x(s),children:e.jsx(g,{})})}}),h()}},ge=async()=>{const o={title:"Delete Tool",description:`Delete tool ${f}?`,confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await q(o))try{(await N.deleteTool(E)).data&&(m({message:"Tool deleted",options:{key:new Date().getTime()+Math.random(),variant:"success",action:T=>e.jsx(l,{style:{color:"white"},onClick:()=>x(T),children:e.jsx(g,{})})}}),D())}catch(r){m({message:`Failed to delete Tool: ${typeof r.response.data=="object"?r.response.data.message:r.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:T=>e.jsx(l,{style:{color:"white"},onClick:()=>x(T),children:e.jsx(g,{})})}}),h()}},ve=o=>{y(o),W(!1)},be=a?e.jsxs(_,{fullWidth:!0,maxWidth:"md",open:a,onClose:h,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(V,{sx:{fontSize:"1rem",p:3,pb:0},id:"alert-dialog-title",children:e.jsxs(p,{sx:{display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[t.title,e.jsx(p,{children:t.type==="EDIT"&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{permissionId:"templates:toolexport",style:{marginRight:"10px"},variant:"outlined",onClick:()=>me(),startIcon:e.jsx(Ge,{}),color:"secondary",children:"Save As Template"}),e.jsx(oe,{permissionId:"tools:export",variant:"outlined",onClick:()=>je(),startIcon:e.jsx(ze,{}),children:"Export"})]})})]})}),e.jsx(K,{sx:{display:"flex",flexDirection:"column",gap:2,maxHeight:"75vh",position:"relative",px:3,pb:3},children:e.jsxs(p,{sx:{display:"flex",flexDirection:"column",gap:2,pt:2},children:[e.jsxs(p,{children:[e.jsxs(w,{sx:{position:"relative",alignItems:"center"},direction:"row",children:[e.jsxs(M,{variant:"overline",children:["Tool Name",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx(L,{title:"Tool name must be small capital letter with underscore. Ex: my_tool"})]}),e.jsx(U,{id:"toolName",type:"string",fullWidth:!0,disabled:t.type==="TEMPLATE",placeholder:"My New Tool",value:f,name:"toolName",onChange:o=>v(o.target.value)})]}),e.jsxs(p,{children:[e.jsxs(w,{sx:{position:"relative",alignItems:"center"},direction:"row",children:[e.jsxs(M,{variant:"overline",children:["Tool description",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx(L,{title:"Description of what the tool does. This is for ChatGPT to determine when to use this tool."})]}),e.jsx(U,{id:"toolDesc",type:"string",fullWidth:!0,disabled:t.type==="TEMPLATE",placeholder:"Description of what the tool does. This is for ChatGPT to determine when to use this tool.",multiline:!0,rows:3,value:k,name:"toolDesc",onChange:o=>b(o.target.value)})]}),e.jsxs(p,{children:[e.jsx(w,{sx:{position:"relative"},direction:"row",children:e.jsx(M,{variant:"overline",children:"Tool Icon Source"})}),e.jsx(U,{id:"toolIcon",type:"string",fullWidth:!0,disabled:t.type==="TEMPLATE",placeholder:"https://raw.githubusercontent.com/gilbarbara/logos/main/logos/airtable.svg",value:R,name:"toolIcon",onChange:o=>A(o.target.value)})]}),e.jsxs(p,{children:[e.jsxs(w,{sx:{position:"relative",justifyContent:"space-between"},direction:"row",children:[e.jsxs(w,{sx:{position:"relative",alignItems:"center"},direction:"row",children:[e.jsx(M,{variant:"overline",children:"Input Schema"}),e.jsx(L,{title:"What is the input format in JSON?"})]}),t.type!=="TEMPLATE"&&e.jsxs(w,{direction:"row",spacing:1,children:[e.jsx(l,{variant:"outlined",onClick:()=>W(!0),startIcon:e.jsx(We,{}),children:"Paste JSON"}),e.jsx(l,{variant:"outlined",onClick:he,startIcon:e.jsx(qe,{}),children:"Add Item"})]})]}),e.jsx(Oe,{columns:fe,rows:F,disabled:t.type==="TEMPLATE",onRowUpdate:xe})]}),e.jsxs(p,{children:[e.jsxs(p,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(w,{sx:{position:"relative",alignItems:"center"},direction:"row",children:[e.jsx(M,{variant:"overline",children:"Javascript Function"}),e.jsx(L,{title:'Function to execute when tool is being used. You can use properties specified in Input Schema as variables. For example, if the property is <code>userid</code>, you can use as <code>$userid</code>. Return value must be a string. You can also override the code from API by following this <a target="_blank" href="https://docs.flowiseai.com/tools/custom-tool#override-function-from-api">guide</a>'})]}),e.jsxs(w,{direction:"row",children:[e.jsx(l,{style:{marginBottom:10,marginRight:10},color:"secondary",variant:"text",onClick:()=>X(!0),children:"How to use Function"}),t.type!=="TEMPLATE"&&e.jsx(l,{style:{marginBottom:10},variant:"outlined",onClick:()=>d(Ke),children:"See Example"})]})]}),e.jsx(re,{disabled:t.type==="TEMPLATE",value:J,theme:C.isDarkMode?"dark":"light",lang:"js",onValueChange:o=>d(o)})]})]})}),e.jsxs(ne,{sx:{p:3},children:[t.type==="EDIT"&&e.jsx(se,{permissionId:"tools:delete",color:"error",variant:"contained",onClick:()=>ge(),children:"Delete"}),t.type==="TEMPLATE"&&e.jsx(Ae,{permission:"tools:view,tools:create",children:e.jsx(ie,{color:"secondary",variant:"contained",onClick:ye,children:"Use Template"})}),t.type!=="TEMPLATE"&&e.jsx(se,{permissionId:"tools:update,tools:create",disabled:!(f&&k),variant:"contained",onClick:()=>t.type==="ADD"||t.type==="IMPORT"?Te():we(),children:t.confirmButtonName})]}),e.jsx(Je,{}),Q&&e.jsx(Be,{show:Q,dialogProps:pe,onCancel:()=>Z(!1)}),e.jsx(le,{show:de,onCancel:()=>X(!1)}),P&&e.jsx(ce,{show:P,onCancel:()=>W(!1),onConfirm:ve,customization:C})]}):null;return H.createPortal(be,O)};Xe.propTypes={show:c.bool,dialogProps:c.object,onUseTemplate:c.func,onCancel:c.func,onConfirm:c.func,setError:c.func};export{We as I,Xe as T,Ge as a,N as t};
